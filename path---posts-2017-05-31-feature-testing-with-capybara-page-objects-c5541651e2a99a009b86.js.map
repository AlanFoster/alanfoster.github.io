{"version":3,"sources":["webpack:///path---posts-2017-05-31-feature-testing-with-capybara-page-objects-c5541651e2a99a009b86.js","webpack:///./.cache/json/posts-2017-05-31-feature-testing-with-capybara-page-objects.json"],"names":["webpackJsonp","354","module","exports","data","markdownRemark","html","frontmatter","title","date","fields","slug","pathContext"],"mappings":"AAAAA,cAAc,iBAERC,IACA,SAAUC,EAAQC,GCHxBD,EAAAC,SAAkBC,MAAQC,gBAAkBC,KAAA,w52BAAg9uBC,aAAivJC,MAAA,6CAAAC,KAAA,gBAA2EC,QAAWC,KAAA,mEAAyEC,aAAgBD,KAAA","file":"path---posts-2017-05-31-feature-testing-with-capybara-page-objects-c5541651e2a99a009b86.js","sourcesContent":["webpackJsonp([230637783338568],{\n\n/***/ 354:\n/***/ (function(module, exports) {\n\n\tmodule.exports = {\"data\":{\"markdownRemark\":{\"html\":\"<p>Page objects can be used as a powerful method of abstracting your tests from implementation. Importantly they can be used reduce fragile tests, and promote DRYness - via the encapsulation of common functionality within simple methods.</p>\\n<p>In plain terms:</p>\\n<blockquote>\\n<p>A page object is an instance of a <code>class</code> which abstracts the underlying user interface from your tests, providing methods to interact with the UI, and extract any required information.</p>\\n</blockquote>\\n<h3>Terminology</h3>\\n<p>Unfortunately page objects are an overloaded term. In my experience there are generally three types of page objects:</p>\\n<ul>\\n<li>\\n<p><em>Component Objects</em> - A page object which represents a particular component, or widget, on a user interface. For instance a Table, menu, article, etc.</p>\\n<p>If you are coming from a React background, React components/Classes are generally a one to one mapping with this concept.</p>\\n</li>\\n<li>\\n<p><em>Page Objects</em> - A page object can describe a particular screen, or user interface, within a web application or native application. It can be composed of multiple component objects, and can provide convenience methods for interacting with the abstraction that it is wrapping.</p>\\n</li>\\n<li>\\n<p><em>Experience</em> - These are commonly used to group together complex functionality that may require multiple steps, and interact with multiple pages. In my experience I have used this concept to abstract complex welcome tour functionality, creation wizards, and other complex flows.</p>\\n</li>\\n</ul>\\n<h3>Example</h3>\\n<p>Consider a simple RSpec Capybara test that creates blogs and does not make use of page objects:</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-ruby\\\"><code><span class=\\\"token keyword\\\">require</span> <span class=\\\"token string\\\">'feature_helper'</span>\\n\\nfeature <span class=\\\"token string\\\">'Blog management'</span><span class=\\\"token punctuation\\\">,</span> type<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token symbol\\\">:feature</span> <span class=\\\"token keyword\\\">do</span>\\n  scenario <span class=\\\"token string\\\">'Successfully creating a new blog'</span> <span class=\\\"token keyword\\\">do</span>\\n    visit <span class=\\\"token string\\\">'/'</span>\\n\\n    click_on <span class=\\\"token string\\\">'Form Examples'</span>\\n    <span class=\\\"token function\\\">expect</span><span class=\\\"token punctuation\\\">(</span>page<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span>to <span class=\\\"token function\\\">have_content</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'Create Blog'</span><span class=\\\"token punctuation\\\">)</span>\\n\\n    fill_in <span class=\\\"token string\\\">'blog_title'</span><span class=\\\"token punctuation\\\">,</span> with<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">'My Blog Title'</span>\\n    fill_in <span class=\\\"token string\\\">'blog_text'</span><span class=\\\"token punctuation\\\">,</span> with<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">'My new blog text'</span>\\n\\n    click_on <span class=\\\"token string\\\">'Save Blog'</span>\\n    <span class=\\\"token function\\\">expect</span><span class=\\\"token punctuation\\\">(</span>page<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span>to <span class=\\\"token function\\\">have_selector</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'.blog--show'</span><span class=\\\"token punctuation\\\">)</span>\\n\\n    <span class=\\\"token function\\\">expect</span><span class=\\\"token punctuation\\\">(</span>page<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span>to <span class=\\\"token function\\\">have_content</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'My Blog Title'</span><span class=\\\"token punctuation\\\">)</span>\\n    <span class=\\\"token function\\\">expect</span><span class=\\\"token punctuation\\\">(</span>page<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span>to <span class=\\\"token function\\\">have_content</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'My new blog text'</span><span class=\\\"token punctuation\\\">)</span>\\n  <span class=\\\"token keyword\\\">end</span>\\n\\n  scenario <span class=\\\"token string\\\">'Entering no data'</span> <span class=\\\"token keyword\\\">do</span>\\n    visit <span class=\\\"token string\\\">'/'</span>\\n    click_on <span class=\\\"token string\\\">'Form Examples'</span>\\n\\n    <span class=\\\"token function\\\">expect</span><span class=\\\"token punctuation\\\">(</span>page<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span>to <span class=\\\"token function\\\">have_content</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'Create Blog'</span><span class=\\\"token punctuation\\\">)</span>\\n\\n    click_on <span class=\\\"token string\\\">'Save Blog'</span>\\n\\n    <span class=\\\"token function\\\">expect</span><span class=\\\"token punctuation\\\">(</span>page<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span>to <span class=\\\"token function\\\">have_content</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'4 errors stopped this form being submitted'</span><span class=\\\"token punctuation\\\">)</span>\\n\\n    <span class=\\\"token function\\\">expect</span><span class=\\\"token punctuation\\\">(</span>page<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span>to <span class=\\\"token function\\\">have_content</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"Title can't be blank\\\"</span><span class=\\\"token punctuation\\\">)</span>\\n    <span class=\\\"token function\\\">expect</span><span class=\\\"token punctuation\\\">(</span>page<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span>to <span class=\\\"token function\\\">have_content</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"Text can't be blank\\\"</span><span class=\\\"token punctuation\\\">)</span>\\n\\n    <span class=\\\"token function\\\">expect</span><span class=\\\"token punctuation\\\">(</span>page<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span>to <span class=\\\"token function\\\">have_content</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'Title is too short'</span><span class=\\\"token punctuation\\\">)</span>\\n    <span class=\\\"token function\\\">expect</span><span class=\\\"token punctuation\\\">(</span>page<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span>to <span class=\\\"token function\\\">have_content</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'Text is too short'</span><span class=\\\"token punctuation\\\">)</span>\\n  <span class=\\\"token keyword\\\">end</span>\\n<span class=\\\"token keyword\\\">end</span>\\n</code></pre>\\n      </div>\\n<p>Looking at this snippet - there are multiple concerns. There is the act of navigating to the appropriate page, interacting with the page, and asserting content. It is also possible to see duplicated code that could potentially be more DRY.</p>\\n<p>Importantly this code can become difficult to maintain if there are changes to application under test. For instance element classes/names/ids may change, there will be multiple places of update required.</p>\\n<p>There is also a lack of 'semantic context' within this code, it can be hard to see what lines of code are logically grouped together.</p>\\n<h3>Introducing Page Objects</h3>\\n<p>As discussed within the terminology section, Page Objects can be used to provide abstractions for the view layer.</p>\\n<p>Taking the previous example, and introducing a PageObject for creating new blogs, and viewing blogs, we can begin to clear up our previous example.</p>\\n<p>Without providing specific implementation details, the end-goal should be readable, and lacking specific user interface details should as class names, xpaths etc:</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-ruby\\\"><code><span class=\\\"token keyword\\\">require</span> <span class=\\\"token string\\\">'feature_helper'</span>\\nrequire_relative <span class=\\\"token string\\\">'../pages/new_blog'</span>\\nrequire_relative <span class=\\\"token string\\\">'../pages/view_blog'</span>\\n\\nfeature <span class=\\\"token string\\\">'Blog management'</span><span class=\\\"token punctuation\\\">,</span> type<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token symbol\\\">:feature</span> <span class=\\\"token keyword\\\">do</span>\\n  <span class=\\\"token function\\\">let</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token symbol\\\">:new_blog_page</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span> <span class=\\\"token punctuation\\\">:</span><span class=\\\"token symbol\\\">:Pages</span><span class=\\\"token punctuation\\\">:</span><span class=\\\"token symbol\\\">:NewBlog</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token keyword\\\">new</span> <span class=\\\"token punctuation\\\">}</span>\\n  <span class=\\\"token function\\\">let</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token symbol\\\">:view_blog_page</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span> <span class=\\\"token punctuation\\\">:</span><span class=\\\"token symbol\\\">:Pages</span><span class=\\\"token punctuation\\\">:</span><span class=\\\"token symbol\\\">:ViewBlog</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token keyword\\\">new</span> <span class=\\\"token punctuation\\\">}</span>\\n\\n  before <span class=\\\"token symbol\\\">:each</span> <span class=\\\"token keyword\\\">do</span>\\n    new_blog_page<span class=\\\"token punctuation\\\">.</span>visit_location\\n  <span class=\\\"token keyword\\\">end</span>\\n\\n  scenario <span class=\\\"token string\\\">'Successfully creating a new blog'</span> <span class=\\\"token keyword\\\">do</span>\\n    new_blog_page<span class=\\\"token punctuation\\\">.</span>create title<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">'My Blog Title'</span><span class=\\\"token punctuation\\\">,</span>\\n                         text<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">'My new blog text'</span>\\n\\n    <span class=\\\"token function\\\">expect</span><span class=\\\"token punctuation\\\">(</span>view_blog_page<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span>to have_loaded\\n    <span class=\\\"token function\\\">expect</span><span class=\\\"token punctuation\\\">(</span>view_blog_page<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span>to have_blog title<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">'My Blog Title'</span><span class=\\\"token punctuation\\\">,</span>\\n                                        text<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">'My new blog text'</span>\\n  <span class=\\\"token keyword\\\">end</span>\\n\\n  scenario <span class=\\\"token string\\\">'Entering no data'</span> <span class=\\\"token keyword\\\">do</span>\\n    new_blog_page<span class=\\\"token punctuation\\\">.</span>create title<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">''</span><span class=\\\"token punctuation\\\">,</span>\\n                         text<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">''</span>\\n\\n    <span class=\\\"token function\\\">expect</span><span class=\\\"token punctuation\\\">(</span>view_blog_page<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span>to_not have_loaded\\n    <span class=\\\"token function\\\">expect</span><span class=\\\"token punctuation\\\">(</span>new_blog_page<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span>to have_errors <span class=\\\"token string\\\">\\\"Title can't be blank\\\"</span><span class=\\\"token punctuation\\\">,</span>\\n                                         <span class=\\\"token string\\\">\\\"Text can't be blank\\\"</span><span class=\\\"token punctuation\\\">,</span>\\n                                         <span class=\\\"token string\\\">\\\"Title is too short\\\"</span><span class=\\\"token punctuation\\\">,</span>\\n                                         <span class=\\\"token string\\\">\\\"Text is too short\\\"</span>\\n  <span class=\\\"token keyword\\\">end</span>\\n<span class=\\\"token keyword\\\">end</span>\\n</code></pre>\\n      </div>\\n<h3>Creating Page Objects</h3>\\n<p>The first step of creating page objects is to create the basic page class structure:</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-ruby\\\"><code><span class=\\\"token keyword\\\">module</span> <span class=\\\"token constant\\\">Pages</span>\\n  <span class=\\\"token keyword\\\">class</span> <span class=\\\"token class-name\\\">NewBlog</span>\\n    include <span class=\\\"token constant\\\">RSpec</span><span class=\\\"token punctuation\\\">:</span><span class=\\\"token symbol\\\">:Matchers</span>\\n    include <span class=\\\"token constant\\\">Capybara</span><span class=\\\"token punctuation\\\">:</span><span class=\\\"token symbol\\\">:DSL</span>\\n\\n    <span class=\\\"token comment\\\"># ...</span>\\n  <span class=\\\"token keyword\\\">end</span>\\n<span class=\\\"token keyword\\\">end</span>\\n</code></pre>\\n      </div>\\n<p>The inclusion of <code>Capybara::DSL</code> will allow for instances of the Page Object to have access to Capybara's domain specific language:</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-ruby\\\"><code>has_css<span class=\\\"token operator\\\">?</span> <span class=\\\"token string\\\">'.foo'</span>\\nhas_content<span class=\\\"token operator\\\">?</span> <span class=\\\"token string\\\">'hello world'</span>\\n<span class=\\\"token function\\\">find</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'.foo'</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span>click\\n</code></pre>\\n      </div>\\n<p>I have additionally chosen to make use of <code>include RSpec::Matchers</code> within the above examples in order to use RSpec's expectation library.</p>\\n<p>Some purists may follow the convention that Page Objects should <em>not</em> have inbuilt expectations. However I preference this approach in order to rely on Capybara's inbuilt mechanisms to handle race conditions where appropriate.</p>\\n<p>For instance with the following code, Capybara will wait until <code>foo</code> is present within the page object, or it will fail:</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-ruby\\\"><code><span class=\\\"token function\\\">expect</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token keyword\\\">self</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span>to have_content <span class=\\\"token string\\\">'foo'</span>\\n</code></pre>\\n      </div>\\n<p>However, within the following code:</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-ruby\\\"><code><span class=\\\"token function\\\">expect</span><span class=\\\"token punctuation\\\">(</span>page_object<span class=\\\"token punctuation\\\">.</span>content<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span>to match <span class=\\\"token string\\\">'foo'</span>\\n</code></pre>\\n      </div>\\n<p>It is possible to have unexpected race conditions as <code>page_object.content</code> is immediately evaluated, and potentially not valid yet, and asserted upon. For more examples, I would recommend reading thoughtbot's <a href=\\\"https://robots.thoughtbot.com/write-reliable-asynchronous-integration-tests-with-capybara#checking-a-field39s-value\\\">writing reliable asynchronous integration tests with capayara</a>.</p>\\n<h3>Adding methods</h3>\\n<p>We can abstract the location that we wish to visit within a single method:</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-ruby\\\"><code><span class=\\\"token keyword\\\">def</span> visit_location\\n  visit <span class=\\\"token string\\\">'/blogs/new'</span>\\n  <span class=\\\"token comment\\\"># It can be beneficial to assert something positive about the page</span>\\n  <span class=\\\"token comment\\\"># before progressing with your tests at this point</span>\\n  <span class=\\\"token comment\\\">#</span>\\n  <span class=\\\"token comment\\\"># This can be useful to ensures that the page has loaded successfully, and any</span>\\n  <span class=\\\"token comment\\\"># asynchronous JavaScript has been loaded and retrieved etc.</span>\\n  <span class=\\\"token comment\\\">#</span>\\n  <span class=\\\"token comment\\\"># This is required to avoid potential race conditions.</span>\\n  <span class=\\\"token function\\\">expect</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token keyword\\\">self</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span>to have_loaded\\n<span class=\\\"token keyword\\\">end</span>\\n\\n<span class=\\\"token keyword\\\">def</span> has_loaded<span class=\\\"token operator\\\">?</span>\\n  <span class=\\\"token keyword\\\">self</span><span class=\\\"token punctuation\\\">.</span>has_selector<span class=\\\"token operator\\\">?</span> <span class=\\\"token string\\\">'h1'</span><span class=\\\"token punctuation\\\">,</span> text<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">'Create Blog'</span>\\n<span class=\\\"token keyword\\\">end</span>\\n</code></pre>\\n      </div>\\n<p>It is important to provide semantically clear methods to your page objects:</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-ruby\\\"><code><span class=\\\"token keyword\\\">def</span> <span class=\\\"token function\\\">create</span><span class=\\\"token punctuation\\\">(</span>title<span class=\\\"token punctuation\\\">:</span><span class=\\\"token punctuation\\\">,</span> text<span class=\\\"token punctuation\\\">:</span><span class=\\\"token punctuation\\\">)</span>\\n  <span class=\\\"token comment\\\"># ...</span>\\n<span class=\\\"token keyword\\\">end</span>\\n\\n<span class=\\\"token keyword\\\">def</span> has_errors<span class=\\\"token operator\\\">?</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token operator\\\">*</span>errors<span class=\\\"token punctuation\\\">)</span>\\n  <span class=\\\"token comment\\\"># ...</span>\\n<span class=\\\"token keyword\\\">end</span>\\n\\n<span class=\\\"token keyword\\\">def</span> has_error<span class=\\\"token operator\\\">?</span><span class=\\\"token punctuation\\\">(</span>error<span class=\\\"token punctuation\\\">)</span>\\n  <span class=\\\"token comment\\\"># ...</span>\\n<span class=\\\"token keyword\\\">end</span>\\n</code></pre>\\n      </div>\\n<p>In general it is important to follow provide <a href=\\\"https://en.wikipedia.org/wiki/Cohesion_(computer_science)\\\">functionally cohesive methods</a>, and where possible adhere to the <a href=\\\"https://en.wikipedia.org/wiki/Single_responsibility_principle\\\">Single Responsibility Principle</a>.</p>\\n<h3>Component Objects</h3>\\n<p>In our example we are making use of a <code>NewBlog</code> class, but the implementation for <code>create</code> was missing.</p>\\n<p>As we are interacting with a form, we could additionally introduce a class to represent this component:</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-ruby\\\"><code><span class=\\\"token comment\\\"># ...</span>\\n\\n<span class=\\\"token keyword\\\">def</span> <span class=\\\"token function\\\">create</span><span class=\\\"token punctuation\\\">(</span>title<span class=\\\"token punctuation\\\">:</span><span class=\\\"token punctuation\\\">,</span> text<span class=\\\"token punctuation\\\">:</span><span class=\\\"token punctuation\\\">)</span>\\n  blog_form<span class=\\\"token punctuation\\\">.</span><span class=\\\"token keyword\\\">new</span><span class=\\\"token punctuation\\\">.</span>create title<span class=\\\"token punctuation\\\">:</span> title<span class=\\\"token punctuation\\\">,</span>\\n                       text<span class=\\\"token punctuation\\\">:</span> text\\n<span class=\\\"token keyword\\\">end</span>\\n\\n<span class=\\\"token comment\\\"># ...</span>\\n\\nprivate\\n\\n<span class=\\\"token keyword\\\">def</span> blog_form\\n  <span class=\\\"token punctuation\\\">:</span><span class=\\\"token symbol\\\">:Components</span><span class=\\\"token punctuation\\\">:</span><span class=\\\"token symbol\\\">:BlogForm</span>\\n<span class=\\\"token keyword\\\">end</span>\\n</code></pre>\\n      </div>\\n<p>Where the implementation for <code>BlogForm</code> might be:</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-ruby\\\"><code><span class=\\\"token keyword\\\">module</span> <span class=\\\"token constant\\\">Components</span>\\n  <span class=\\\"token keyword\\\">class</span> <span class=\\\"token class-name\\\">BlogForm</span>\\n    include <span class=\\\"token constant\\\">RSpec</span><span class=\\\"token punctuation\\\">:</span><span class=\\\"token symbol\\\">:Matchers</span>\\n    include <span class=\\\"token constant\\\">Capybara</span><span class=\\\"token punctuation\\\">:</span><span class=\\\"token symbol\\\">:DSL</span>\\n\\n    <span class=\\\"token keyword\\\">def</span> <span class=\\\"token function\\\">create</span><span class=\\\"token punctuation\\\">(</span>title<span class=\\\"token punctuation\\\">:</span><span class=\\\"token punctuation\\\">,</span> text<span class=\\\"token punctuation\\\">:</span><span class=\\\"token punctuation\\\">)</span>\\n      within blog_form <span class=\\\"token keyword\\\">do</span>\\n        fill_in <span class=\\\"token string\\\">'blog_title'</span><span class=\\\"token punctuation\\\">,</span> with<span class=\\\"token punctuation\\\">:</span> title\\n        fill_in <span class=\\\"token string\\\">'blog_text'</span><span class=\\\"token punctuation\\\">,</span> with<span class=\\\"token punctuation\\\">:</span> text\\n\\n        click_on <span class=\\\"token string\\\">'Save Blog'</span>\\n      <span class=\\\"token keyword\\\">end</span>\\n    <span class=\\\"token keyword\\\">end</span>\\n\\n    private\\n\\n    <span class=\\\"token keyword\\\">def</span> blog_form\\n      <span class=\\\"token function\\\">find</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'.blog--new'</span><span class=\\\"token punctuation\\\">)</span>\\n    <span class=\\\"token keyword\\\">end</span>\\n  <span class=\\\"token keyword\\\">end</span>\\n<span class=\\\"token keyword\\\">end</span>\\n</code></pre>\\n      </div>\\n<h3>Wiring everything together</h3>\\n<p>With the above classes, it will now be possible to require and instantiate your page objects within your feature spec:</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-ruby\\\"><code><span class=\\\"token keyword\\\">require</span> <span class=\\\"token string\\\">'feature_helper'</span>\\nrequire_relative <span class=\\\"token string\\\">'../pages/new_blog'</span>\\nrequire_relative <span class=\\\"token string\\\">'../pages/view_blog'</span>\\n\\nfeature <span class=\\\"token string\\\">'Blog management'</span><span class=\\\"token punctuation\\\">,</span> type<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token symbol\\\">:feature</span> <span class=\\\"token keyword\\\">do</span>\\n  <span class=\\\"token function\\\">let</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token symbol\\\">:new_blog_page</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span> <span class=\\\"token punctuation\\\">:</span><span class=\\\"token symbol\\\">:Pages</span><span class=\\\"token punctuation\\\">:</span><span class=\\\"token symbol\\\">:NewBlog</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token keyword\\\">new</span> <span class=\\\"token punctuation\\\">}</span>\\n  <span class=\\\"token function\\\">let</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token symbol\\\">:view_blog_page</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span> <span class=\\\"token punctuation\\\">:</span><span class=\\\"token symbol\\\">:Pages</span><span class=\\\"token punctuation\\\">:</span><span class=\\\"token symbol\\\">:ViewBlog</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token keyword\\\">new</span> <span class=\\\"token punctuation\\\">}</span>\\n\\n  <span class=\\\"token comment\\\"># ...</span>\\n<span class=\\\"token keyword\\\">end</span>\\n</code></pre>\\n      </div>\\n<p><em>Note</em>: I have intentionally chosen to require the page object manually at the top of the feature file. In some RSpec applications it may be convenient to auto-load all support files and provide access to them within feature files, however this can become overwhelming with large code bases. In particular it will lead to slow start-up times, and potential unintentional cyclic dependencies.</p>\\n<h3>Calling page objects</h3>\\n<p>Within each scenario we will now have access to the <code>new_blog_page</code> and <code>view_blog_page</code> instances:</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-ruby\\\"><code>scenario <span class=\\\"token string\\\">'Successfully creating a new blog'</span> <span class=\\\"token keyword\\\">do</span>\\n  new_blog_page<span class=\\\"token punctuation\\\">.</span>create title<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">'My Blog Title'</span><span class=\\\"token punctuation\\\">,</span>\\n                       text<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">'My new blog text'</span>\\n\\n  <span class=\\\"token function\\\">expect</span><span class=\\\"token punctuation\\\">(</span>view_blog_page<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span>to have_loaded\\n  <span class=\\\"token function\\\">expect</span><span class=\\\"token punctuation\\\">(</span>view_blog_page<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span>to have_blog title<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">'My Blog Title'</span><span class=\\\"token punctuation\\\">,</span>\\n                                      text<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">'My new blog text'</span>\\n<span class=\\\"token keyword\\\">end</span>\\n</code></pre>\\n      </div>\\n<h3>Naming Conventions / Predicate Methods</h3>\\n<p>As with most things in Rails/Ruby, there are conventions that may not be fully appreciated at first sight.</p>\\n<p>Within our tests we interacted with the page object with <code>have_loaded</code> and <code>have_blog</code>:</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-ruby\\\"><code><span class=\\\"token function\\\">expect</span><span class=\\\"token punctuation\\\">(</span>view_blog_page<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span>to have_loaded\\n<span class=\\\"token function\\\">expect</span><span class=\\\"token punctuation\\\">(</span>view_blog_page<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span>to have_blog title<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">'My Blog Title'</span><span class=\\\"token punctuation\\\">,</span>\\n                                    text<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">'My new blog text'</span>\\n</code></pre>\\n      </div>\\n<p>However, our page object's method names are actually <code>has_loaded?</code> and <code>has_blog?</code>:</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-ruby\\\"><code><span class=\\\"token keyword\\\">def</span> has_loaded<span class=\\\"token operator\\\">?</span>\\n  <span class=\\\"token comment\\\"># ...</span>\\n<span class=\\\"token keyword\\\">end</span>\\n\\n<span class=\\\"token keyword\\\">def</span> has_blog<span class=\\\"token operator\\\">?</span><span class=\\\"token punctuation\\\">(</span>title<span class=\\\"token punctuation\\\">:</span><span class=\\\"token punctuation\\\">,</span> text<span class=\\\"token punctuation\\\">:</span><span class=\\\"token punctuation\\\">)</span>\\n  <span class=\\\"token comment\\\"># ...</span>\\n<span class=\\\"token keyword\\\">end</span>\\n</code></pre>\\n      </div>\\n<p>This is a subtle difference to notice, and attention should be drawn to it. For more details on this convention, I would recommend the <a href=\\\"https://relishapp.com/rspec/rspec-expectations/v/3-5/docs/built-in-matchers/predicate-matchers\\\">predicate matchers</a> documentation.</p>\\n<h3>Source code</h3>\\n<p>For a full example please see the Github pull request <a href=\\\"https://github.com/AlanFoster/rspec-capybara-feature-testing/pull/13/files\\\">here</a></p>\\n<h3>Additional resources</h3>\\n<ul>\\n<li><a href=\\\"https://martinfowler.com/bliki/PageObject.html\\\">Martin Fowler - Page Objects</a></li>\\n<li><a href=\\\"https://robots.thoughtbot.com/write-reliable-asynchronous-integration-tests-with-capybara\\\">Write Reliable, Asynchronous Integration Tests With Capybara</a></li>\\n<li><a href=\\\"https://github.com/natritmeyer/site_prism\\\">Page object DSL for capybara</a></li>\\n<li><a href=\\\"https://github.com/thoughtbot/formulaic\\\">Formulaic - Form input generation</a></li>\\n</ul>\",\"frontmatter\":{\"title\":\"Feature testing with Capybara page objects\",\"date\":\"31 May, 2017\"},\"fields\":{\"slug\":\"/posts/2017-05-31-feature-testing-with-capybara-page-objects/\"}}},\"pathContext\":{\"slug\":\"/posts/2017-05-31-feature-testing-with-capybara-page-objects/\"}}\n\n/***/ })\n\n});\n\n\n// WEBPACK FOOTER //\n// path---posts-2017-05-31-feature-testing-with-capybara-page-objects-c5541651e2a99a009b86.js","module.exports = {\"data\":{\"markdownRemark\":{\"html\":\"<p>Page objects can be used as a powerful method of abstracting your tests from implementation. Importantly they can be used reduce fragile tests, and promote DRYness - via the encapsulation of common functionality within simple methods.</p>\\n<p>In plain terms:</p>\\n<blockquote>\\n<p>A page object is an instance of a <code>class</code> which abstracts the underlying user interface from your tests, providing methods to interact with the UI, and extract any required information.</p>\\n</blockquote>\\n<h3>Terminology</h3>\\n<p>Unfortunately page objects are an overloaded term. In my experience there are generally three types of page objects:</p>\\n<ul>\\n<li>\\n<p><em>Component Objects</em> - A page object which represents a particular component, or widget, on a user interface. For instance a Table, menu, article, etc.</p>\\n<p>If you are coming from a React background, React components/Classes are generally a one to one mapping with this concept.</p>\\n</li>\\n<li>\\n<p><em>Page Objects</em> - A page object can describe a particular screen, or user interface, within a web application or native application. It can be composed of multiple component objects, and can provide convenience methods for interacting with the abstraction that it is wrapping.</p>\\n</li>\\n<li>\\n<p><em>Experience</em> - These are commonly used to group together complex functionality that may require multiple steps, and interact with multiple pages. In my experience I have used this concept to abstract complex welcome tour functionality, creation wizards, and other complex flows.</p>\\n</li>\\n</ul>\\n<h3>Example</h3>\\n<p>Consider a simple RSpec Capybara test that creates blogs and does not make use of page objects:</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-ruby\\\"><code><span class=\\\"token keyword\\\">require</span> <span class=\\\"token string\\\">'feature_helper'</span>\\n\\nfeature <span class=\\\"token string\\\">'Blog management'</span><span class=\\\"token punctuation\\\">,</span> type<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token symbol\\\">:feature</span> <span class=\\\"token keyword\\\">do</span>\\n  scenario <span class=\\\"token string\\\">'Successfully creating a new blog'</span> <span class=\\\"token keyword\\\">do</span>\\n    visit <span class=\\\"token string\\\">'/'</span>\\n\\n    click_on <span class=\\\"token string\\\">'Form Examples'</span>\\n    <span class=\\\"token function\\\">expect</span><span class=\\\"token punctuation\\\">(</span>page<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span>to <span class=\\\"token function\\\">have_content</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'Create Blog'</span><span class=\\\"token punctuation\\\">)</span>\\n\\n    fill_in <span class=\\\"token string\\\">'blog_title'</span><span class=\\\"token punctuation\\\">,</span> with<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">'My Blog Title'</span>\\n    fill_in <span class=\\\"token string\\\">'blog_text'</span><span class=\\\"token punctuation\\\">,</span> with<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">'My new blog text'</span>\\n\\n    click_on <span class=\\\"token string\\\">'Save Blog'</span>\\n    <span class=\\\"token function\\\">expect</span><span class=\\\"token punctuation\\\">(</span>page<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span>to <span class=\\\"token function\\\">have_selector</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'.blog--show'</span><span class=\\\"token punctuation\\\">)</span>\\n\\n    <span class=\\\"token function\\\">expect</span><span class=\\\"token punctuation\\\">(</span>page<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span>to <span class=\\\"token function\\\">have_content</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'My Blog Title'</span><span class=\\\"token punctuation\\\">)</span>\\n    <span class=\\\"token function\\\">expect</span><span class=\\\"token punctuation\\\">(</span>page<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span>to <span class=\\\"token function\\\">have_content</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'My new blog text'</span><span class=\\\"token punctuation\\\">)</span>\\n  <span class=\\\"token keyword\\\">end</span>\\n\\n  scenario <span class=\\\"token string\\\">'Entering no data'</span> <span class=\\\"token keyword\\\">do</span>\\n    visit <span class=\\\"token string\\\">'/'</span>\\n    click_on <span class=\\\"token string\\\">'Form Examples'</span>\\n\\n    <span class=\\\"token function\\\">expect</span><span class=\\\"token punctuation\\\">(</span>page<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span>to <span class=\\\"token function\\\">have_content</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'Create Blog'</span><span class=\\\"token punctuation\\\">)</span>\\n\\n    click_on <span class=\\\"token string\\\">'Save Blog'</span>\\n\\n    <span class=\\\"token function\\\">expect</span><span class=\\\"token punctuation\\\">(</span>page<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span>to <span class=\\\"token function\\\">have_content</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'4 errors stopped this form being submitted'</span><span class=\\\"token punctuation\\\">)</span>\\n\\n    <span class=\\\"token function\\\">expect</span><span class=\\\"token punctuation\\\">(</span>page<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span>to <span class=\\\"token function\\\">have_content</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"Title can't be blank\\\"</span><span class=\\\"token punctuation\\\">)</span>\\n    <span class=\\\"token function\\\">expect</span><span class=\\\"token punctuation\\\">(</span>page<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span>to <span class=\\\"token function\\\">have_content</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"Text can't be blank\\\"</span><span class=\\\"token punctuation\\\">)</span>\\n\\n    <span class=\\\"token function\\\">expect</span><span class=\\\"token punctuation\\\">(</span>page<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span>to <span class=\\\"token function\\\">have_content</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'Title is too short'</span><span class=\\\"token punctuation\\\">)</span>\\n    <span class=\\\"token function\\\">expect</span><span class=\\\"token punctuation\\\">(</span>page<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span>to <span class=\\\"token function\\\">have_content</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'Text is too short'</span><span class=\\\"token punctuation\\\">)</span>\\n  <span class=\\\"token keyword\\\">end</span>\\n<span class=\\\"token keyword\\\">end</span>\\n</code></pre>\\n      </div>\\n<p>Looking at this snippet - there are multiple concerns. There is the act of navigating to the appropriate page, interacting with the page, and asserting content. It is also possible to see duplicated code that could potentially be more DRY.</p>\\n<p>Importantly this code can become difficult to maintain if there are changes to application under test. For instance element classes/names/ids may change, there will be multiple places of update required.</p>\\n<p>There is also a lack of 'semantic context' within this code, it can be hard to see what lines of code are logically grouped together.</p>\\n<h3>Introducing Page Objects</h3>\\n<p>As discussed within the terminology section, Page Objects can be used to provide abstractions for the view layer.</p>\\n<p>Taking the previous example, and introducing a PageObject for creating new blogs, and viewing blogs, we can begin to clear up our previous example.</p>\\n<p>Without providing specific implementation details, the end-goal should be readable, and lacking specific user interface details should as class names, xpaths etc:</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-ruby\\\"><code><span class=\\\"token keyword\\\">require</span> <span class=\\\"token string\\\">'feature_helper'</span>\\nrequire_relative <span class=\\\"token string\\\">'../pages/new_blog'</span>\\nrequire_relative <span class=\\\"token string\\\">'../pages/view_blog'</span>\\n\\nfeature <span class=\\\"token string\\\">'Blog management'</span><span class=\\\"token punctuation\\\">,</span> type<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token symbol\\\">:feature</span> <span class=\\\"token keyword\\\">do</span>\\n  <span class=\\\"token function\\\">let</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token symbol\\\">:new_blog_page</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span> <span class=\\\"token punctuation\\\">:</span><span class=\\\"token symbol\\\">:Pages</span><span class=\\\"token punctuation\\\">:</span><span class=\\\"token symbol\\\">:NewBlog</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token keyword\\\">new</span> <span class=\\\"token punctuation\\\">}</span>\\n  <span class=\\\"token function\\\">let</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token symbol\\\">:view_blog_page</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span> <span class=\\\"token punctuation\\\">:</span><span class=\\\"token symbol\\\">:Pages</span><span class=\\\"token punctuation\\\">:</span><span class=\\\"token symbol\\\">:ViewBlog</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token keyword\\\">new</span> <span class=\\\"token punctuation\\\">}</span>\\n\\n  before <span class=\\\"token symbol\\\">:each</span> <span class=\\\"token keyword\\\">do</span>\\n    new_blog_page<span class=\\\"token punctuation\\\">.</span>visit_location\\n  <span class=\\\"token keyword\\\">end</span>\\n\\n  scenario <span class=\\\"token string\\\">'Successfully creating a new blog'</span> <span class=\\\"token keyword\\\">do</span>\\n    new_blog_page<span class=\\\"token punctuation\\\">.</span>create title<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">'My Blog Title'</span><span class=\\\"token punctuation\\\">,</span>\\n                         text<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">'My new blog text'</span>\\n\\n    <span class=\\\"token function\\\">expect</span><span class=\\\"token punctuation\\\">(</span>view_blog_page<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span>to have_loaded\\n    <span class=\\\"token function\\\">expect</span><span class=\\\"token punctuation\\\">(</span>view_blog_page<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span>to have_blog title<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">'My Blog Title'</span><span class=\\\"token punctuation\\\">,</span>\\n                                        text<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">'My new blog text'</span>\\n  <span class=\\\"token keyword\\\">end</span>\\n\\n  scenario <span class=\\\"token string\\\">'Entering no data'</span> <span class=\\\"token keyword\\\">do</span>\\n    new_blog_page<span class=\\\"token punctuation\\\">.</span>create title<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">''</span><span class=\\\"token punctuation\\\">,</span>\\n                         text<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">''</span>\\n\\n    <span class=\\\"token function\\\">expect</span><span class=\\\"token punctuation\\\">(</span>view_blog_page<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span>to_not have_loaded\\n    <span class=\\\"token function\\\">expect</span><span class=\\\"token punctuation\\\">(</span>new_blog_page<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span>to have_errors <span class=\\\"token string\\\">\\\"Title can't be blank\\\"</span><span class=\\\"token punctuation\\\">,</span>\\n                                         <span class=\\\"token string\\\">\\\"Text can't be blank\\\"</span><span class=\\\"token punctuation\\\">,</span>\\n                                         <span class=\\\"token string\\\">\\\"Title is too short\\\"</span><span class=\\\"token punctuation\\\">,</span>\\n                                         <span class=\\\"token string\\\">\\\"Text is too short\\\"</span>\\n  <span class=\\\"token keyword\\\">end</span>\\n<span class=\\\"token keyword\\\">end</span>\\n</code></pre>\\n      </div>\\n<h3>Creating Page Objects</h3>\\n<p>The first step of creating page objects is to create the basic page class structure:</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-ruby\\\"><code><span class=\\\"token keyword\\\">module</span> <span class=\\\"token constant\\\">Pages</span>\\n  <span class=\\\"token keyword\\\">class</span> <span class=\\\"token class-name\\\">NewBlog</span>\\n    include <span class=\\\"token constant\\\">RSpec</span><span class=\\\"token punctuation\\\">:</span><span class=\\\"token symbol\\\">:Matchers</span>\\n    include <span class=\\\"token constant\\\">Capybara</span><span class=\\\"token punctuation\\\">:</span><span class=\\\"token symbol\\\">:DSL</span>\\n\\n    <span class=\\\"token comment\\\"># ...</span>\\n  <span class=\\\"token keyword\\\">end</span>\\n<span class=\\\"token keyword\\\">end</span>\\n</code></pre>\\n      </div>\\n<p>The inclusion of <code>Capybara::DSL</code> will allow for instances of the Page Object to have access to Capybara's domain specific language:</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-ruby\\\"><code>has_css<span class=\\\"token operator\\\">?</span> <span class=\\\"token string\\\">'.foo'</span>\\nhas_content<span class=\\\"token operator\\\">?</span> <span class=\\\"token string\\\">'hello world'</span>\\n<span class=\\\"token function\\\">find</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'.foo'</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span>click\\n</code></pre>\\n      </div>\\n<p>I have additionally chosen to make use of <code>include RSpec::Matchers</code> within the above examples in order to use RSpec's expectation library.</p>\\n<p>Some purists may follow the convention that Page Objects should <em>not</em> have inbuilt expectations. However I preference this approach in order to rely on Capybara's inbuilt mechanisms to handle race conditions where appropriate.</p>\\n<p>For instance with the following code, Capybara will wait until <code>foo</code> is present within the page object, or it will fail:</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-ruby\\\"><code><span class=\\\"token function\\\">expect</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token keyword\\\">self</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span>to have_content <span class=\\\"token string\\\">'foo'</span>\\n</code></pre>\\n      </div>\\n<p>However, within the following code:</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-ruby\\\"><code><span class=\\\"token function\\\">expect</span><span class=\\\"token punctuation\\\">(</span>page_object<span class=\\\"token punctuation\\\">.</span>content<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span>to match <span class=\\\"token string\\\">'foo'</span>\\n</code></pre>\\n      </div>\\n<p>It is possible to have unexpected race conditions as <code>page_object.content</code> is immediately evaluated, and potentially not valid yet, and asserted upon. For more examples, I would recommend reading thoughtbot's <a href=\\\"https://robots.thoughtbot.com/write-reliable-asynchronous-integration-tests-with-capybara#checking-a-field39s-value\\\">writing reliable asynchronous integration tests with capayara</a>.</p>\\n<h3>Adding methods</h3>\\n<p>We can abstract the location that we wish to visit within a single method:</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-ruby\\\"><code><span class=\\\"token keyword\\\">def</span> visit_location\\n  visit <span class=\\\"token string\\\">'/blogs/new'</span>\\n  <span class=\\\"token comment\\\"># It can be beneficial to assert something positive about the page</span>\\n  <span class=\\\"token comment\\\"># before progressing with your tests at this point</span>\\n  <span class=\\\"token comment\\\">#</span>\\n  <span class=\\\"token comment\\\"># This can be useful to ensures that the page has loaded successfully, and any</span>\\n  <span class=\\\"token comment\\\"># asynchronous JavaScript has been loaded and retrieved etc.</span>\\n  <span class=\\\"token comment\\\">#</span>\\n  <span class=\\\"token comment\\\"># This is required to avoid potential race conditions.</span>\\n  <span class=\\\"token function\\\">expect</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token keyword\\\">self</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span>to have_loaded\\n<span class=\\\"token keyword\\\">end</span>\\n\\n<span class=\\\"token keyword\\\">def</span> has_loaded<span class=\\\"token operator\\\">?</span>\\n  <span class=\\\"token keyword\\\">self</span><span class=\\\"token punctuation\\\">.</span>has_selector<span class=\\\"token operator\\\">?</span> <span class=\\\"token string\\\">'h1'</span><span class=\\\"token punctuation\\\">,</span> text<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">'Create Blog'</span>\\n<span class=\\\"token keyword\\\">end</span>\\n</code></pre>\\n      </div>\\n<p>It is important to provide semantically clear methods to your page objects:</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-ruby\\\"><code><span class=\\\"token keyword\\\">def</span> <span class=\\\"token function\\\">create</span><span class=\\\"token punctuation\\\">(</span>title<span class=\\\"token punctuation\\\">:</span><span class=\\\"token punctuation\\\">,</span> text<span class=\\\"token punctuation\\\">:</span><span class=\\\"token punctuation\\\">)</span>\\n  <span class=\\\"token comment\\\"># ...</span>\\n<span class=\\\"token keyword\\\">end</span>\\n\\n<span class=\\\"token keyword\\\">def</span> has_errors<span class=\\\"token operator\\\">?</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token operator\\\">*</span>errors<span class=\\\"token punctuation\\\">)</span>\\n  <span class=\\\"token comment\\\"># ...</span>\\n<span class=\\\"token keyword\\\">end</span>\\n\\n<span class=\\\"token keyword\\\">def</span> has_error<span class=\\\"token operator\\\">?</span><span class=\\\"token punctuation\\\">(</span>error<span class=\\\"token punctuation\\\">)</span>\\n  <span class=\\\"token comment\\\"># ...</span>\\n<span class=\\\"token keyword\\\">end</span>\\n</code></pre>\\n      </div>\\n<p>In general it is important to follow provide <a href=\\\"https://en.wikipedia.org/wiki/Cohesion_(computer_science)\\\">functionally cohesive methods</a>, and where possible adhere to the <a href=\\\"https://en.wikipedia.org/wiki/Single_responsibility_principle\\\">Single Responsibility Principle</a>.</p>\\n<h3>Component Objects</h3>\\n<p>In our example we are making use of a <code>NewBlog</code> class, but the implementation for <code>create</code> was missing.</p>\\n<p>As we are interacting with a form, we could additionally introduce a class to represent this component:</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-ruby\\\"><code><span class=\\\"token comment\\\"># ...</span>\\n\\n<span class=\\\"token keyword\\\">def</span> <span class=\\\"token function\\\">create</span><span class=\\\"token punctuation\\\">(</span>title<span class=\\\"token punctuation\\\">:</span><span class=\\\"token punctuation\\\">,</span> text<span class=\\\"token punctuation\\\">:</span><span class=\\\"token punctuation\\\">)</span>\\n  blog_form<span class=\\\"token punctuation\\\">.</span><span class=\\\"token keyword\\\">new</span><span class=\\\"token punctuation\\\">.</span>create title<span class=\\\"token punctuation\\\">:</span> title<span class=\\\"token punctuation\\\">,</span>\\n                       text<span class=\\\"token punctuation\\\">:</span> text\\n<span class=\\\"token keyword\\\">end</span>\\n\\n<span class=\\\"token comment\\\"># ...</span>\\n\\nprivate\\n\\n<span class=\\\"token keyword\\\">def</span> blog_form\\n  <span class=\\\"token punctuation\\\">:</span><span class=\\\"token symbol\\\">:Components</span><span class=\\\"token punctuation\\\">:</span><span class=\\\"token symbol\\\">:BlogForm</span>\\n<span class=\\\"token keyword\\\">end</span>\\n</code></pre>\\n      </div>\\n<p>Where the implementation for <code>BlogForm</code> might be:</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-ruby\\\"><code><span class=\\\"token keyword\\\">module</span> <span class=\\\"token constant\\\">Components</span>\\n  <span class=\\\"token keyword\\\">class</span> <span class=\\\"token class-name\\\">BlogForm</span>\\n    include <span class=\\\"token constant\\\">RSpec</span><span class=\\\"token punctuation\\\">:</span><span class=\\\"token symbol\\\">:Matchers</span>\\n    include <span class=\\\"token constant\\\">Capybara</span><span class=\\\"token punctuation\\\">:</span><span class=\\\"token symbol\\\">:DSL</span>\\n\\n    <span class=\\\"token keyword\\\">def</span> <span class=\\\"token function\\\">create</span><span class=\\\"token punctuation\\\">(</span>title<span class=\\\"token punctuation\\\">:</span><span class=\\\"token punctuation\\\">,</span> text<span class=\\\"token punctuation\\\">:</span><span class=\\\"token punctuation\\\">)</span>\\n      within blog_form <span class=\\\"token keyword\\\">do</span>\\n        fill_in <span class=\\\"token string\\\">'blog_title'</span><span class=\\\"token punctuation\\\">,</span> with<span class=\\\"token punctuation\\\">:</span> title\\n        fill_in <span class=\\\"token string\\\">'blog_text'</span><span class=\\\"token punctuation\\\">,</span> with<span class=\\\"token punctuation\\\">:</span> text\\n\\n        click_on <span class=\\\"token string\\\">'Save Blog'</span>\\n      <span class=\\\"token keyword\\\">end</span>\\n    <span class=\\\"token keyword\\\">end</span>\\n\\n    private\\n\\n    <span class=\\\"token keyword\\\">def</span> blog_form\\n      <span class=\\\"token function\\\">find</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'.blog--new'</span><span class=\\\"token punctuation\\\">)</span>\\n    <span class=\\\"token keyword\\\">end</span>\\n  <span class=\\\"token keyword\\\">end</span>\\n<span class=\\\"token keyword\\\">end</span>\\n</code></pre>\\n      </div>\\n<h3>Wiring everything together</h3>\\n<p>With the above classes, it will now be possible to require and instantiate your page objects within your feature spec:</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-ruby\\\"><code><span class=\\\"token keyword\\\">require</span> <span class=\\\"token string\\\">'feature_helper'</span>\\nrequire_relative <span class=\\\"token string\\\">'../pages/new_blog'</span>\\nrequire_relative <span class=\\\"token string\\\">'../pages/view_blog'</span>\\n\\nfeature <span class=\\\"token string\\\">'Blog management'</span><span class=\\\"token punctuation\\\">,</span> type<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token symbol\\\">:feature</span> <span class=\\\"token keyword\\\">do</span>\\n  <span class=\\\"token function\\\">let</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token symbol\\\">:new_blog_page</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span> <span class=\\\"token punctuation\\\">:</span><span class=\\\"token symbol\\\">:Pages</span><span class=\\\"token punctuation\\\">:</span><span class=\\\"token symbol\\\">:NewBlog</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token keyword\\\">new</span> <span class=\\\"token punctuation\\\">}</span>\\n  <span class=\\\"token function\\\">let</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token symbol\\\">:view_blog_page</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span> <span class=\\\"token punctuation\\\">:</span><span class=\\\"token symbol\\\">:Pages</span><span class=\\\"token punctuation\\\">:</span><span class=\\\"token symbol\\\">:ViewBlog</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token keyword\\\">new</span> <span class=\\\"token punctuation\\\">}</span>\\n\\n  <span class=\\\"token comment\\\"># ...</span>\\n<span class=\\\"token keyword\\\">end</span>\\n</code></pre>\\n      </div>\\n<p><em>Note</em>: I have intentionally chosen to require the page object manually at the top of the feature file. In some RSpec applications it may be convenient to auto-load all support files and provide access to them within feature files, however this can become overwhelming with large code bases. In particular it will lead to slow start-up times, and potential unintentional cyclic dependencies.</p>\\n<h3>Calling page objects</h3>\\n<p>Within each scenario we will now have access to the <code>new_blog_page</code> and <code>view_blog_page</code> instances:</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-ruby\\\"><code>scenario <span class=\\\"token string\\\">'Successfully creating a new blog'</span> <span class=\\\"token keyword\\\">do</span>\\n  new_blog_page<span class=\\\"token punctuation\\\">.</span>create title<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">'My Blog Title'</span><span class=\\\"token punctuation\\\">,</span>\\n                       text<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">'My new blog text'</span>\\n\\n  <span class=\\\"token function\\\">expect</span><span class=\\\"token punctuation\\\">(</span>view_blog_page<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span>to have_loaded\\n  <span class=\\\"token function\\\">expect</span><span class=\\\"token punctuation\\\">(</span>view_blog_page<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span>to have_blog title<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">'My Blog Title'</span><span class=\\\"token punctuation\\\">,</span>\\n                                      text<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">'My new blog text'</span>\\n<span class=\\\"token keyword\\\">end</span>\\n</code></pre>\\n      </div>\\n<h3>Naming Conventions / Predicate Methods</h3>\\n<p>As with most things in Rails/Ruby, there are conventions that may not be fully appreciated at first sight.</p>\\n<p>Within our tests we interacted with the page object with <code>have_loaded</code> and <code>have_blog</code>:</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-ruby\\\"><code><span class=\\\"token function\\\">expect</span><span class=\\\"token punctuation\\\">(</span>view_blog_page<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span>to have_loaded\\n<span class=\\\"token function\\\">expect</span><span class=\\\"token punctuation\\\">(</span>view_blog_page<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span>to have_blog title<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">'My Blog Title'</span><span class=\\\"token punctuation\\\">,</span>\\n                                    text<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">'My new blog text'</span>\\n</code></pre>\\n      </div>\\n<p>However, our page object's method names are actually <code>has_loaded?</code> and <code>has_blog?</code>:</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-ruby\\\"><code><span class=\\\"token keyword\\\">def</span> has_loaded<span class=\\\"token operator\\\">?</span>\\n  <span class=\\\"token comment\\\"># ...</span>\\n<span class=\\\"token keyword\\\">end</span>\\n\\n<span class=\\\"token keyword\\\">def</span> has_blog<span class=\\\"token operator\\\">?</span><span class=\\\"token punctuation\\\">(</span>title<span class=\\\"token punctuation\\\">:</span><span class=\\\"token punctuation\\\">,</span> text<span class=\\\"token punctuation\\\">:</span><span class=\\\"token punctuation\\\">)</span>\\n  <span class=\\\"token comment\\\"># ...</span>\\n<span class=\\\"token keyword\\\">end</span>\\n</code></pre>\\n      </div>\\n<p>This is a subtle difference to notice, and attention should be drawn to it. For more details on this convention, I would recommend the <a href=\\\"https://relishapp.com/rspec/rspec-expectations/v/3-5/docs/built-in-matchers/predicate-matchers\\\">predicate matchers</a> documentation.</p>\\n<h3>Source code</h3>\\n<p>For a full example please see the Github pull request <a href=\\\"https://github.com/AlanFoster/rspec-capybara-feature-testing/pull/13/files\\\">here</a></p>\\n<h3>Additional resources</h3>\\n<ul>\\n<li><a href=\\\"https://martinfowler.com/bliki/PageObject.html\\\">Martin Fowler - Page Objects</a></li>\\n<li><a href=\\\"https://robots.thoughtbot.com/write-reliable-asynchronous-integration-tests-with-capybara\\\">Write Reliable, Asynchronous Integration Tests With Capybara</a></li>\\n<li><a href=\\\"https://github.com/natritmeyer/site_prism\\\">Page object DSL for capybara</a></li>\\n<li><a href=\\\"https://github.com/thoughtbot/formulaic\\\">Formulaic - Form input generation</a></li>\\n</ul>\",\"frontmatter\":{\"title\":\"Feature testing with Capybara page objects\",\"date\":\"31 May, 2017\"},\"fields\":{\"slug\":\"/posts/2017-05-31-feature-testing-with-capybara-page-objects/\"}}},\"pathContext\":{\"slug\":\"/posts/2017-05-31-feature-testing-with-capybara-page-objects/\"}}\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/json-loader!./.cache/json/posts-2017-05-31-feature-testing-with-capybara-page-objects.json\n// module id = 354\n// module chunks = 230637783338568"],"sourceRoot":""}