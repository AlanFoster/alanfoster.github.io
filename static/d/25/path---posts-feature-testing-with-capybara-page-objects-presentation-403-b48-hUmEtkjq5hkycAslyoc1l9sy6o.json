{"data":{"content":{"id":"58f20ace-cd76-5800-8c08-57d525d4ff14","frontmatter":{"title":"Feature testing with Capybara page objects","workshop":null,"date":"31 May, 2017"},"fields":{"slug":"/posts/feature-testing-with-capybara-page-objects/"},"htmlAst":{"type":"root","children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Page objects can be used as a powerful method of abstracting your tests from implementation. Importantly they can be used reduce fragile tests, and promote DRYness - via the encapsulation of common functionality within simple methods."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"In plain terms:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"blockquote","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"A page object is an instance of a "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"class"}]},{"type":"text","value":" which abstracts the underlying user interface from your tests, providing methods to interact with the UI, and extract any required information."}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{"id":"terminology"},"children":[{"type":"element","tagName":"a","properties":{"href":"#terminology","ariaHidden":true,"className":["anchor"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"Terminology"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Unfortunately page objects are an overloaded term. In my experience there are generally three types of page objects:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"Component Objects"}]},{"type":"text","value":" - A page object which represents a particular component, or widget, on a user interface. For instance a Table, menu, article, etc."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"If you are coming from a React background, React components/Classes are generally a one to one mapping with this concept."}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"Page Objects"}]},{"type":"text","value":" - A page object can describe a particular screen, or user interface, within a web application or native application. It can be composed of multiple component objects, and can provide convenience methods for interacting with the abstraction that it is wrapping."}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"Experience"}]},{"type":"text","value":" - These are commonly used to group together complex functionality that may require multiple steps, and interact with multiple pages. In my experience I have used this concept to abstract complex welcome tour functionality, creation wizards, and other complex flows."}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{"id":"example"},"children":[{"type":"element","tagName":"a","properties":{"href":"#example","ariaHidden":true,"className":["anchor"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"Example"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Consider a simple RSpec Capybara test that creates blogs and does not make use of page objects:"}]},{"type":"text","value":"\n\n            "},{"type":"element","tagName":"div","properties":{"className":["code-snippet"]},"children":[{"type":"text","value":"\n              \n              "},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"]},"children":[{"type":"text","value":"\n                "},{"type":"element","tagName":"pre","properties":{"className":["language-ruby"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-ruby"]},"children":[{"type":"text","value":"require 'feature_helper'\n\nfeature 'Blog management', type: :feature do\n  scenario 'Successfully creating a new blog' do\n    visit '/'\n\n    click_on 'Form Examples'\n    expect(page).to have_content('Create Blog')\n\n    fill_in 'blog_title', with: 'My Blog Title'\n    fill_in 'blog_text', with: 'My new blog text'\n\n    click_on 'Save Blog'\n    expect(page).to have_selector('.blog--show')\n\n    expect(page).to have_content('My Blog Title')\n    expect(page).to have_content('My new blog text')\n  end\n\n  scenario 'Entering no data' do\n    visit '/'\n    click_on 'Form Examples'\n\n    expect(page).to have_content('Create Blog')\n\n    click_on 'Save Blog'\n\n    expect(page).to have_content('4 errors stopped this form being submitted')\n\n    expect(page).to have_content(\"Title can't be blank\")\n    expect(page).to have_content(\"Text can't be blank\")\n\n    expect(page).to have_content('Title is too short')\n    expect(page).to have_content('Text is too short')\n  end\nend"}]}]},{"type":"text","value":"\n              "}]},{"type":"text","value":"\n            "}]},{"type":"text","value":"\n          \n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Looking at this snippet - there are multiple concerns. There is the act of navigating to the appropriate page, interacting with the page, and asserting content. It is also possible to see duplicated code that could potentially be more DRY."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Importantly this code can become difficult to maintain if there are changes to application under test. For instance element classes/names/ids may change, there will be multiple places of update required."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"There is also a lack of 'semantic context' within this code, it can be hard to see what lines of code are logically grouped together."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{"id":"introducing-page-objects"},"children":[{"type":"element","tagName":"a","properties":{"href":"#introducing-page-objects","ariaHidden":true,"className":["anchor"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"Introducing Page Objects"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"As discussed within the terminology section, Page Objects can be used to provide abstractions for the view layer."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Taking the previous example, and introducing a PageObject for creating new blogs, and viewing blogs, we can begin to clear up our previous example."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Without providing specific implementation details, the end-goal should be readable, and lacking specific user interface details should as class names, xpaths etc:"}]},{"type":"text","value":"\n\n            "},{"type":"element","tagName":"div","properties":{"className":["code-snippet"]},"children":[{"type":"text","value":"\n              \n              "},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"]},"children":[{"type":"text","value":"\n                "},{"type":"element","tagName":"pre","properties":{"className":["language-ruby"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-ruby"]},"children":[{"type":"text","value":"require 'feature_helper'\nrequire_relative '../pages/new_blog'\nrequire_relative '../pages/view_blog'\n\nfeature 'Blog management', type: :feature do\n  let(:new_blog_page) { ::Pages::NewBlog.new }\n  let(:view_blog_page) { ::Pages::ViewBlog.new }\n\n  before :each do\n    new_blog_page.visit_location\n  end\n\n  scenario 'Successfully creating a new blog' do\n    new_blog_page.create title: 'My Blog Title',\n                         text: 'My new blog text'\n\n    expect(view_blog_page).to have_loaded\n    expect(view_blog_page).to have_blog title: 'My Blog Title',\n                                        text: 'My new blog text'\n  end\n\n  scenario 'Entering no data' do\n    new_blog_page.create title: '',\n                         text: ''\n\n    expect(view_blog_page).to_not have_loaded\n    expect(new_blog_page).to have_errors \"Title can't be blank\",\n                                         \"Text can't be blank\",\n                                         \"Title is too short\",\n                                         \"Text is too short\"\n  end\nend"}]}]},{"type":"text","value":"\n              "}]},{"type":"text","value":"\n            "}]},{"type":"text","value":"\n          \n"},{"type":"element","tagName":"h3","properties":{"id":"creating-page-objects"},"children":[{"type":"element","tagName":"a","properties":{"href":"#creating-page-objects","ariaHidden":true,"className":["anchor"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"Creating Page Objects"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The first step of creating page objects is to create the basic page class structure:"}]},{"type":"text","value":"\n\n            "},{"type":"element","tagName":"div","properties":{"className":["code-snippet"]},"children":[{"type":"text","value":"\n              \n              "},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"]},"children":[{"type":"text","value":"\n                "},{"type":"element","tagName":"pre","properties":{"className":["language-ruby"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-ruby"]},"children":[{"type":"text","value":"module Pages\n  class NewBlog\n    include RSpec::Matchers\n    include Capybara::DSL\n\n    # ...\n  end\nend"}]}]},{"type":"text","value":"\n              "}]},{"type":"text","value":"\n            "}]},{"type":"text","value":"\n          \n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The inclusion of "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"Capybara::DSL"}]},{"type":"text","value":" will allow for instances of the Page Object to have access to Capybara's domain specific language:"}]},{"type":"text","value":"\n\n            "},{"type":"element","tagName":"div","properties":{"className":["code-snippet"]},"children":[{"type":"text","value":"\n              \n              "},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"]},"children":[{"type":"text","value":"\n                "},{"type":"element","tagName":"pre","properties":{"className":["language-ruby"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-ruby"]},"children":[{"type":"text","value":"has_css? '.foo'\nhas_content? 'hello world'\nfind('.foo').click"}]}]},{"type":"text","value":"\n              "}]},{"type":"text","value":"\n            "}]},{"type":"text","value":"\n          \n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"I have additionally chosen to make use of "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"include RSpec::Matchers"}]},{"type":"text","value":" within the above examples in order to use RSpec's expectation library."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Some purists may follow the convention that Page Objects should "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"not"}]},{"type":"text","value":" have inbuilt expectations. However I preference this approach in order to rely on Capybara's inbuilt mechanisms to handle race conditions where appropriate."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"For instance with the following code, Capybara will wait until "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"foo"}]},{"type":"text","value":" is present within the page object, or it will fail:"}]},{"type":"text","value":"\n\n            "},{"type":"element","tagName":"div","properties":{"className":["code-snippet"]},"children":[{"type":"text","value":"\n              \n              "},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"]},"children":[{"type":"text","value":"\n                "},{"type":"element","tagName":"pre","properties":{"className":["language-ruby"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-ruby"]},"children":[{"type":"text","value":"expect(self).to have_content 'foo'"}]}]},{"type":"text","value":"\n              "}]},{"type":"text","value":"\n            "}]},{"type":"text","value":"\n          \n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"However, within the following code:"}]},{"type":"text","value":"\n\n            "},{"type":"element","tagName":"div","properties":{"className":["code-snippet"]},"children":[{"type":"text","value":"\n              \n              "},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"]},"children":[{"type":"text","value":"\n                "},{"type":"element","tagName":"pre","properties":{"className":["language-ruby"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-ruby"]},"children":[{"type":"text","value":"expect(page_object.content).to match 'foo'"}]}]},{"type":"text","value":"\n              "}]},{"type":"text","value":"\n            "}]},{"type":"text","value":"\n          \n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"It is possible to have unexpected race conditions as "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"page_object.content"}]},{"type":"text","value":" is immediately evaluated, and potentially not valid yet, and asserted upon. For more examples, I would recommend reading thoughtbot's "},{"type":"element","tagName":"a","properties":{"href":"https://robots.thoughtbot.com/write-reliable-asynchronous-integration-tests-with-capybara#checking-a-field39s-value"},"children":[{"type":"text","value":"writing reliable asynchronous integration tests with capayara"}]},{"type":"text","value":"."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{"id":"adding-methods"},"children":[{"type":"element","tagName":"a","properties":{"href":"#adding-methods","ariaHidden":true,"className":["anchor"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"Adding methods"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"We can abstract the location that we wish to visit within a single method:"}]},{"type":"text","value":"\n\n            "},{"type":"element","tagName":"div","properties":{"className":["code-snippet"]},"children":[{"type":"text","value":"\n              \n              "},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"]},"children":[{"type":"text","value":"\n                "},{"type":"element","tagName":"pre","properties":{"className":["language-ruby"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-ruby"]},"children":[{"type":"text","value":"def visit_location\n  visit '/blogs/new'\n  # It can be beneficial to assert something positive about the page\n  # before progressing with your tests at this point\n  #\n  # This can be useful to ensures that the page has loaded successfully, and any\n  # asynchronous JavaScript has been loaded and retrieved etc.\n  #\n  # This is required to avoid potential race conditions.\n  expect(self).to have_loaded\nend\n\ndef has_loaded?\n  self.has_selector? 'h1', text: 'Create Blog'\nend"}]}]},{"type":"text","value":"\n              "}]},{"type":"text","value":"\n            "}]},{"type":"text","value":"\n          \n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"It is important to provide semantically clear methods to your page objects:"}]},{"type":"text","value":"\n\n            "},{"type":"element","tagName":"div","properties":{"className":["code-snippet"]},"children":[{"type":"text","value":"\n              \n              "},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"]},"children":[{"type":"text","value":"\n                "},{"type":"element","tagName":"pre","properties":{"className":["language-ruby"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-ruby"]},"children":[{"type":"text","value":"def create(title:, text:)\n  # ...\nend\n\ndef has_errors?(*errors)\n  # ...\nend\n\ndef has_error?(error)\n  # ...\nend"}]}]},{"type":"text","value":"\n              "}]},{"type":"text","value":"\n            "}]},{"type":"text","value":"\n          \n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"In general it is important to follow provide "},{"type":"element","tagName":"a","properties":{"href":"https://en.wikipedia.org/wiki/Cohesion_(computer_science)"},"children":[{"type":"text","value":"functionally cohesive methods"}]},{"type":"text","value":", and where possible adhere to the "},{"type":"element","tagName":"a","properties":{"href":"https://en.wikipedia.org/wiki/Single_responsibility_principle"},"children":[{"type":"text","value":"Single Responsibility Principle"}]},{"type":"text","value":"."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{"id":"component-objects"},"children":[{"type":"element","tagName":"a","properties":{"href":"#component-objects","ariaHidden":true,"className":["anchor"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"Component Objects"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"In our example we are making use of a "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"NewBlog"}]},{"type":"text","value":" class, but the implementation for "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"create"}]},{"type":"text","value":" was missing."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"As we are interacting with a form, we could additionally introduce a class to represent this component:"}]},{"type":"text","value":"\n\n            "},{"type":"element","tagName":"div","properties":{"className":["code-snippet"]},"children":[{"type":"text","value":"\n              \n              "},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"]},"children":[{"type":"text","value":"\n                "},{"type":"element","tagName":"pre","properties":{"className":["language-ruby"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-ruby"]},"children":[{"type":"text","value":"# ...\n\ndef create(title:, text:)\n  blog_form.new.create title: title,\n                       text: text\nend\n\n# ...\n\nprivate\n\ndef blog_form\n  ::Components::BlogForm\nend"}]}]},{"type":"text","value":"\n              "}]},{"type":"text","value":"\n            "}]},{"type":"text","value":"\n          \n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Where the implementation for "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"BlogForm"}]},{"type":"text","value":" might be:"}]},{"type":"text","value":"\n\n            "},{"type":"element","tagName":"div","properties":{"className":["code-snippet"]},"children":[{"type":"text","value":"\n              \n              "},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"]},"children":[{"type":"text","value":"\n                "},{"type":"element","tagName":"pre","properties":{"className":["language-ruby"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-ruby"]},"children":[{"type":"text","value":"module Components\n  class BlogForm\n    include RSpec::Matchers\n    include Capybara::DSL\n\n    def create(title:, text:)\n      within blog_form do\n        fill_in 'blog_title', with: title\n        fill_in 'blog_text', with: text\n\n        click_on 'Save Blog'\n      end\n    end\n\n    private\n\n    def blog_form\n      find('.blog--new')\n    end\n  end\nend"}]}]},{"type":"text","value":"\n              "}]},{"type":"text","value":"\n            "}]},{"type":"text","value":"\n          \n"},{"type":"element","tagName":"h3","properties":{"id":"wiring-everything-together"},"children":[{"type":"element","tagName":"a","properties":{"href":"#wiring-everything-together","ariaHidden":true,"className":["anchor"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"Wiring everything together"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"With the above classes, it will now be possible to require and instantiate your page objects within your feature spec:"}]},{"type":"text","value":"\n\n            "},{"type":"element","tagName":"div","properties":{"className":["code-snippet"]},"children":[{"type":"text","value":"\n              \n              "},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"]},"children":[{"type":"text","value":"\n                "},{"type":"element","tagName":"pre","properties":{"className":["language-ruby"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-ruby"]},"children":[{"type":"text","value":"require 'feature_helper'\nrequire_relative '../pages/new_blog'\nrequire_relative '../pages/view_blog'\n\nfeature 'Blog management', type: :feature do\n  let(:new_blog_page) { ::Pages::NewBlog.new }\n  let(:view_blog_page) { ::Pages::ViewBlog.new }\n\n  # ...\nend"}]}]},{"type":"text","value":"\n              "}]},{"type":"text","value":"\n            "}]},{"type":"text","value":"\n          \n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"Note"}]},{"type":"text","value":": I have intentionally chosen to require the page object manually at the top of the feature file. In some RSpec applications it may be convenient to auto-load all support files and provide access to them within feature files, however this can become overwhelming with large code bases. In particular it will lead to slow start-up times, and potential unintentional cyclic dependencies."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{"id":"calling-page-objects"},"children":[{"type":"element","tagName":"a","properties":{"href":"#calling-page-objects","ariaHidden":true,"className":["anchor"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"Calling page objects"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Within each scenario we will now have access to the "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"new_blog_page"}]},{"type":"text","value":" and "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"view_blog_page"}]},{"type":"text","value":" instances:"}]},{"type":"text","value":"\n\n            "},{"type":"element","tagName":"div","properties":{"className":["code-snippet"]},"children":[{"type":"text","value":"\n              \n              "},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"]},"children":[{"type":"text","value":"\n                "},{"type":"element","tagName":"pre","properties":{"className":["language-ruby"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-ruby"]},"children":[{"type":"text","value":"scenario 'Successfully creating a new blog' do\n  new_blog_page.create title: 'My Blog Title',\n                       text: 'My new blog text'\n\n  expect(view_blog_page).to have_loaded\n  expect(view_blog_page).to have_blog title: 'My Blog Title',\n                                      text: 'My new blog text'\nend"}]}]},{"type":"text","value":"\n              "}]},{"type":"text","value":"\n            "}]},{"type":"text","value":"\n          \n"},{"type":"element","tagName":"h3","properties":{"id":"naming-conventions--predicate-methods"},"children":[{"type":"element","tagName":"a","properties":{"href":"#naming-conventions--predicate-methods","ariaHidden":true,"className":["anchor"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"Naming Conventions / Predicate Methods"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"As with most things in Rails/Ruby, there are conventions that may not be fully appreciated at first sight."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Within our tests we interacted with the page object with "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"have_loaded"}]},{"type":"text","value":" and "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"have_blog"}]},{"type":"text","value":":"}]},{"type":"text","value":"\n\n            "},{"type":"element","tagName":"div","properties":{"className":["code-snippet"]},"children":[{"type":"text","value":"\n              \n              "},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"]},"children":[{"type":"text","value":"\n                "},{"type":"element","tagName":"pre","properties":{"className":["language-ruby"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-ruby"]},"children":[{"type":"text","value":"expect(view_blog_page).to have_loaded\nexpect(view_blog_page).to have_blog title: 'My Blog Title',\n                                    text: 'My new blog text'"}]}]},{"type":"text","value":"\n              "}]},{"type":"text","value":"\n            "}]},{"type":"text","value":"\n          \n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"However, our page object's method names are actually "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"has_loaded?"}]},{"type":"text","value":" and "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"has_blog?"}]},{"type":"text","value":":"}]},{"type":"text","value":"\n\n            "},{"type":"element","tagName":"div","properties":{"className":["code-snippet"]},"children":[{"type":"text","value":"\n              \n              "},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"]},"children":[{"type":"text","value":"\n                "},{"type":"element","tagName":"pre","properties":{"className":["language-ruby"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-ruby"]},"children":[{"type":"text","value":"def has_loaded?\n  # ...\nend\n\ndef has_blog?(title:, text:)\n  # ...\nend"}]}]},{"type":"text","value":"\n              "}]},{"type":"text","value":"\n            "}]},{"type":"text","value":"\n          \n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"This is a subtle difference to notice, and attention should be drawn to it. For more details on this convention, I would recommend the "},{"type":"element","tagName":"a","properties":{"href":"https://relishapp.com/rspec/rspec-expectations/v/3-5/docs/built-in-matchers/predicate-matchers"},"children":[{"type":"text","value":"predicate matchers"}]},{"type":"text","value":" documentation."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{"id":"source-code"},"children":[{"type":"element","tagName":"a","properties":{"href":"#source-code","ariaHidden":true,"className":["anchor"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"Source code"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"For a full example please see the Github pull request "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/AlanFoster/rspec-capybara-feature-testing/pull/13/files"},"children":[{"type":"text","value":"here"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{"id":"additional-resources"},"children":[{"type":"element","tagName":"a","properties":{"href":"#additional-resources","ariaHidden":true,"className":["anchor"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"Additional resources"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://martinfowler.com/bliki/PageObject.html"},"children":[{"type":"text","value":"Martin Fowler - Page Objects"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://robots.thoughtbot.com/write-reliable-asynchronous-integration-tests-with-capybara"},"children":[{"type":"text","value":"Write Reliable, Asynchronous Integration Tests With Capybara"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://github.com/natritmeyer/site_prism"},"children":[{"type":"text","value":"Page object DSL for capybara"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://github.com/thoughtbot/formulaic"},"children":[{"type":"text","value":"Formulaic - Form input generation"}]}]},{"type":"text","value":"\n"}]}],"data":{"quirksMode":false}}}},"pageContext":{"slug":"/posts/feature-testing-with-capybara-page-objects/"}}