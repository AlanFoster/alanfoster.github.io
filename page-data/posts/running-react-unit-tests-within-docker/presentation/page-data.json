{"componentChunkName":"component---src-templates-post-presentation-index-js","path":"/posts/running-react-unit-tests-within-docker/presentation","result":{"data":{"content":{"id":"ec9ad315-4af0-5449-9593-8bb8a53434ed","frontmatter":{"title":"Running react unit tests within docker","workshop":null,"date":"03 June, 2017"},"fields":{"slug":"/posts/running-react-unit-tests-within-docker/"},"htmlAst":{"type":"root","children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Docker is a great way to provide a consistent environment for running your development environment, test suite, as well as your production servers. It provides an easy method of specifying the environment requirements, dependencies, as well as your required linux distribution."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"For instance; If you are making use of automated tests as part of your Continuous Integration pipeline, it can be useful to know how to run your JavaScript tests within a docker container."}]},{"type":"text","value":"\n"},{"type":"comment","value":" end-excerpt "},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{"id":"your-application","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#your-application","ariaLabel":"your application permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"Your application"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"This post assumes that you have a React/JavaScript application ready to be tested."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"For this post I will assume that we're using "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/react-community/create-react-native-app"},"children":[{"type":"text","value":"create-react-native-app"}]},{"type":"text","value":":"}]},{"type":"text","value":"\n\n            "},{"type":"element","tagName":"div","properties":{"className":["code-snippet"]},"children":[{"type":"text","value":"\n              \n              "},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"]},"children":[{"type":"text","value":"\n                "},{"type":"element","tagName":"pre","properties":{"className":["language-bash"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-bash"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"npm"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"install"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","parameter","variable"]},"children":[{"type":"text","value":"-g"}]},{"type":"text","value":" create-react-app\ncreate-react-app my-app\n"},{"type":"element","tagName":"span","properties":{"className":["token","builtin","class-name"]},"children":[{"type":"text","value":"cd"}]},{"type":"text","value":" my-app"}]}]},{"type":"text","value":"\n              "}]},{"type":"text","value":"\n            "}]},{"type":"text","value":"\n          \n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"You should be able to confirm that your react application is running as expected with:"}]},{"type":"text","value":"\n\n            "},{"type":"element","tagName":"div","properties":{"className":["code-snippet"]},"children":[{"type":"text","value":"\n              \n              "},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"]},"children":[{"type":"text","value":"\n                "},{"type":"element","tagName":"pre","properties":{"className":["language-bash"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-bash"]},"children":[{"type":"text","value":"$ "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"npm"}]},{"type":"text","value":" start\n\nCompiled successfully"},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"!"}]},{"type":"text","value":"\n\nYou can now view my-app "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"in"}]},{"type":"text","value":" the browser.\n\n  Local:            http://localhost:3000/\n  On Your Network:  http://192.168.1.160:3000/"}]}]},{"type":"text","value":"\n              "}]},{"type":"text","value":"\n            "}]},{"type":"text","value":"\n          \n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"You should be able to confirm that all tests are running as expected with:"}]},{"type":"text","value":"\n\n            "},{"type":"element","tagName":"div","properties":{"className":["code-snippet"]},"children":[{"type":"text","value":"\n              \n              "},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"]},"children":[{"type":"text","value":"\n                "},{"type":"element","tagName":"pre","properties":{"className":["language-bash"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-bash"]},"children":[{"type":"text","value":"$ "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"npm"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","builtin","class-name"]},"children":[{"type":"text","value":"test"}]},{"type":"text","value":"\n\n PASS  src/App.test.js\n  ✓ renders without crashing "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"24ms"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n\nTest Suites: "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1"}]},{"type":"text","value":" passed, "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1"}]},{"type":"text","value":" total\nTests:       "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1"}]},{"type":"text","value":" passed, "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1"}]},{"type":"text","value":" total\nSnapshots:   "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"0"}]},{"type":"text","value":" total\nTime:        "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1"}]},{"type":"text","value":".14s\nRan all "},{"type":"element","tagName":"span","properties":{"className":["token","builtin","class-name"]},"children":[{"type":"text","value":"test"}]},{"type":"text","value":" suites related to changed files.\n\nWatch Usage\n › Press p to filter by a filename regex pattern.\n › Press t to filter by a "},{"type":"element","tagName":"span","properties":{"className":["token","builtin","class-name"]},"children":[{"type":"text","value":"test"}]},{"type":"text","value":" name regex pattern.\n › Press q to quit "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"watch"}]},{"type":"text","value":" mode.\n › Press Enter to trigger a "},{"type":"element","tagName":"span","properties":{"className":["token","builtin","class-name"]},"children":[{"type":"text","value":"test"}]},{"type":"text","value":" run."}]}]},{"type":"text","value":"\n              "}]},{"type":"text","value":"\n            "}]},{"type":"text","value":"\n          \n"},{"type":"element","tagName":"h3","properties":{"id":"installing-docker","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#installing-docker","ariaLabel":"installing docker permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"Installing docker"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The first step is installing docker. The specific installation steps will be different if you are on a windows machine, mac, etc."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Please see the latest install steps at "},{"type":"element","tagName":"a","properties":{"href":"https://www.docker.com"},"children":[{"type":"text","value":"https://www.docker.com"}]},{"type":"text","value":"."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"You should be able to verify that your local install is running with:"}]},{"type":"text","value":"\n\n            "},{"type":"element","tagName":"div","properties":{"className":["code-snippet"]},"children":[{"type":"text","value":"\n              \n              "},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"]},"children":[{"type":"text","value":"\n                "},{"type":"element","tagName":"pre","properties":{"className":["language-bash"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-bash"]},"children":[{"type":"text","value":"$ "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"docker"}]},{"type":"text","value":" run hello-world\n\nlatest: Pulling from library/hello-world\n78445dd45222: Pull complete\nDigest: sha256:c5515758d4c5e1e838e9cd307f6c6a0d620b5e07e6f927b07d05f6d12a1ac8d7\nStatus: Downloaded newer image "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"for"}]},{"type":"text","value":" hello-world:latest\n\nHello from Docker"},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"!"}]}]}]},{"type":"text","value":"\n              "}]},{"type":"text","value":"\n            "}]},{"type":"text","value":"\n          \n"},{"type":"element","tagName":"h3","properties":{"id":"containers-and-images","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#containers-and-images","ariaLabel":"containers and images permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"Containers and images"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"A docker image is the built blueprint of the environment that you want. It is built from a "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"Dockerfile"}]},{"type":"text","value":" which specifies the environment and software requirements."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"A container is a running instance of a docker image. There can be many instances of the same docker image."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{"id":"creating-a-docker-file","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#creating-a-docker-file","ariaLabel":"creating a docker file permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"Creating a docker file"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Docker depends on having a "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"Dockerfile"}]},{"type":"text","value":" which specifies the environment and software requirements."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Create a new Docker file with:"}]},{"type":"text","value":"\n\n            "},{"type":"element","tagName":"div","properties":{"className":["code-snippet"]},"children":[{"type":"text","value":"\n              \n              "},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"]},"children":[{"type":"text","value":"\n                "},{"type":"element","tagName":"pre","properties":{"className":["language-bash"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-bash"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"touch"}]},{"type":"text","value":" Dockerfile"}]}]},{"type":"text","value":"\n              "}]},{"type":"text","value":"\n            "}]},{"type":"text","value":"\n          \n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"With the following content:"}]},{"type":"text","value":"\n\n            "},{"type":"element","tagName":"div","properties":{"className":["code-snippet"]},"children":[{"type":"text","value":"\n              \n              "},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"]},"children":[{"type":"text","value":"\n                "},{"type":"element","tagName":"pre","properties":{"className":["language-docker"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-docker"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","instruction"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"FROM"}]},{"type":"text","value":" node:8.0.0-alpine"}]},{"type":"text","value":"\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","instruction"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"RUN"}]},{"type":"text","value":" mkdir /srv/example"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","instruction"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"WORKDIR"}]},{"type":"text","value":" /srv/example"}]},{"type":"text","value":"\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","instruction"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"COPY"}]},{"type":"text","value":" package.json yarn.lock ./"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","instruction"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"RUN"}]},{"type":"text","value":" yarn && yarn cache clean"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","instruction"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"COPY"}]},{"type":"text","value":" . ."}]}]}]},{"type":"text","value":"\n              "}]},{"type":"text","value":"\n            "}]},{"type":"text","value":"\n          \n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Docker will run sequentially through each line within the docker file."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"FROM node:8.0.0-alpine"}]},{"type":"text","value":" - For our application we wish to run on an environment that has node and yarn installed. Thankfully this is a common requirement and there are various base docker images that can be used and searched for within the "},{"type":"element","tagName":"a","properties":{"href":"https://hub.docker.com/"},"children":[{"type":"text","value":"docker hub"}]},{"type":"text","value":". In our case we can specify a node version from the "},{"type":"element","tagName":"a","properties":{"href":"https://hub.docker.com/_/node/"},"children":[{"type":"text","value":"node official repository"}]},{"type":"text","value":". In particular we will make use of the Alpine linux distro, which is small - at only around 5MB."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"RUN mkdir /srv/app"}]},{"type":"text","value":" - Create a new folder to contain our application"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"WORKDIR /srv/app"}]},{"type":"text","value":" - Specify the working directory for future commands such as "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"COPY"}]},{"type":"text","value":", "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"ADD"}]},{"type":"text","value":", etc."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"COPY package.json yarn.lock ./"}]},{"type":"text","value":" - Place the required dependency files onto our image. Note that the copy command follows the pattern "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"COPY <src>... <dest>"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"RUN yarn && yarn cache clean"}]},{"type":"text","value":" Install our dependencies and remove the cache in one operation."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"COPY . ."}]},{"type":"text","value":" Copy the rest of the files within our daemon context into our working directory."}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Remember: With Docker, order matters. Docker will run each instruction independently, and if possible Docker will attempt to re-use intermediate steps if possible. This is why we chose to copy across our "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"package.json"}]},{"type":"text","value":" and "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"yarn.lock"}]},{"type":"text","value":" before running the "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"yarn"}]},{"type":"text","value":" install command. Importantly, we wish for any changes to these files to invalidate the next docker step and download the updated dependencies. However we don't wish to download our dependencies again if other unrelated files change. The atomic nature of the "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"RUN"}]},{"type":"text","value":" command explains explains why we delete our yarn cache too, as we don't want for these files to be cached by Docker and create an necessarily large docker image."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{"id":"reducing-files-sent-to-the-docker-daemon","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#reducing-files-sent-to-the-docker-daemon","ariaLabel":"reducing files sent to the docker daemon permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"Reducing files sent to the docker daemon"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"When building a docker image the current directory's contents are sent to the running docker daemon. If you are working in a local development environment this can be a bad idea. For instance this may copy across all of the contents of your "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"node_modules"}]},{"type":"text","value":" directory leading to slow docker build times. Even worse there is the potential of copying various "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":".env"}]},{"type":"text","value":" files into your docker container - which could contain environment variables such as keys and passwords that you definitely do not want to distribute by accident."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Thankfully, similar to a "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":".gitignore"}]},{"type":"text","value":" file, you can specify a "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":".dockerignore"}]},{"type":"text","value":" file."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Create a new "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":".dockerignore"}]},{"type":"text","value":" file with the following content:"}]},{"type":"text","value":"\n\n            "},{"type":"element","tagName":"div","properties":{"className":["code-snippet"]},"children":[{"type":"text","value":"\n              \n              "},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"]},"children":[{"type":"text","value":"\n                "},{"type":"element","tagName":"pre","properties":{"className":["language-bash"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-bash"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# Ignore all files by default"}]},{"type":"text","value":"\n*\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# White list only the required files"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"!"}]},{"type":"text","value":"src/\n"},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"!"}]},{"type":"text","value":"public/\n"},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"!"}]},{"type":"text","value":"package.json\n"},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"!"}]},{"type":"text","value":"yarn.lock"}]}]},{"type":"text","value":"\n              "}]},{"type":"text","value":"\n            "}]},{"type":"text","value":"\n          \n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"In my experience I prefer white-listing rather than black listing files for docker. It is better for a docker build to break because you forgot to white list an additional dependency, than it is to have secrets shared without realizing."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"Note"}]},{"type":"text","value":": If you are creating a dockerignore file for your own project, you may wish to include additional files such as "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":".babelrc"}]},{"type":"text","value":", "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":".eslint"}]},{"type":"text","value":" etc. Particularly if you are planning to run linting rules as part of your CI pipeline."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{"id":"using-docker-compose","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#using-docker-compose","ariaLabel":"using docker compose permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"Using docker compose"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Docker compose allows you to manage multi-container docker applications. In our case we can use it to build our image and run a one-of command to verify that our tests are working."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Create a new file "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"docker-compose.yml"}]},{"type":"text","value":" with the content:"}]},{"type":"text","value":"\n\n            "},{"type":"element","tagName":"div","properties":{"className":["code-snippet"]},"children":[{"type":"text","value":"\n              \n              "},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"]},"children":[{"type":"text","value":"\n                "},{"type":"element","tagName":"pre","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"version"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'3'"}]},{"type":"text","value":"\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"services"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"test"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"build"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"context"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" .\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"environment"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" CI=true\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"command"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" npm test"}]}]},{"type":"text","value":"\n              "}]},{"type":"text","value":"\n            "}]},{"type":"text","value":"\n          \n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The following commands will now build our image, as well as execute "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"npm test"}]},{"type":"text","value":":"}]},{"type":"text","value":"\n\n            "},{"type":"element","tagName":"div","properties":{"className":["code-snippet"]},"children":[{"type":"text","value":"\n              \n              "},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"]},"children":[{"type":"text","value":"\n                "},{"type":"element","tagName":"pre","properties":{"className":["language-bash"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-bash"]},"children":[{"type":"text","value":"$ "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"docker-compose"}]},{"type":"text","value":" build "},{"type":"element","tagName":"span","properties":{"className":["token","builtin","class-name"]},"children":[{"type":"text","value":"test"}]},{"type":"text","value":"\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":".."}]},{"type":"text","value":".\n\n$ "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"docker-compose"}]},{"type":"text","value":" run "},{"type":"element","tagName":"span","properties":{"className":["token","parameter","variable"]},"children":[{"type":"text","value":"--rm"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","builtin","class-name"]},"children":[{"type":"text","value":"test"}]},{"type":"text","value":"\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"npm"}]},{"type":"text","value":" info it worked "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"if"}]},{"type":"text","value":" it ends with ok\n"},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"npm"}]},{"type":"text","value":" info using npm@5.0.0\n"},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"npm"}]},{"type":"text","value":" info using node@v8.0.0\n"},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"npm"}]},{"type":"text","value":" info lifecycle my-app@0.1.0~pretest: my-app@0.1.0\n"},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"npm"}]},{"type":"text","value":" info lifecycle my-app@0.1.0~test: my-app@0.1.0\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":">"}]},{"type":"text","value":" my-app@0.1.0 "},{"type":"element","tagName":"span","properties":{"className":["token","builtin","class-name"]},"children":[{"type":"text","value":"test"}]},{"type":"text","value":" /srv/example\n"},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":">"}]},{"type":"text","value":" react-scripts "},{"type":"element","tagName":"span","properties":{"className":["token","builtin","class-name"]},"children":[{"type":"text","value":"test"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","parameter","variable"]},"children":[{"type":"text","value":"--env"}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":"jsdom\n\n PASS  src/App.test.js\n  ✓ renders without crashing "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"29ms"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n\nTest Suites: "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1"}]},{"type":"text","value":" passed, "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1"}]},{"type":"text","value":" total\nTests:       "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1"}]},{"type":"text","value":" passed, "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1"}]},{"type":"text","value":" total\nSnapshots:   "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"0"}]},{"type":"text","value":" total\nTime:        "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1"}]},{"type":"text","value":".284s\nRan all "},{"type":"element","tagName":"span","properties":{"className":["token","builtin","class-name"]},"children":[{"type":"text","value":"test"}]},{"type":"text","value":" suites.\n"},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"npm"}]},{"type":"text","value":" info lifecycle my-app@0.1.0~posttest: my-app@0.1.0\n"},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"npm"}]},{"type":"text","value":" info ok"}]}]},{"type":"text","value":"\n              "}]},{"type":"text","value":"\n            "}]},{"type":"text","value":"\n          \n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Note that within our docker-compose file we also needed to specify the environment variable "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"CI=true"}]},{"type":"text","value":" - otherwise by default jest will run in "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"--watch"}]},{"type":"text","value":" mode."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Additionally we have specified the "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"--rm"}]},{"type":"text","value":" option within our run command, to delete our container after the command completes."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Importantly, if our test fails - the correct status code will be returned. This is useful to break your build in a CI environment:"}]},{"type":"text","value":"\n\n            "},{"type":"element","tagName":"div","properties":{"className":["code-snippet"]},"children":[{"type":"text","value":"\n              \n              "},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"]},"children":[{"type":"text","value":"\n                "},{"type":"element","tagName":"pre","properties":{"className":["language-bash"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-bash"]},"children":[{"type":"text","value":"$ "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"docker-compose"}]},{"type":"text","value":" run "},{"type":"element","tagName":"span","properties":{"className":["token","parameter","variable"]},"children":[{"type":"text","value":"--rm"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","builtin","class-name"]},"children":[{"type":"text","value":"test"}]},{"type":"text","value":"\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":".."}]},{"type":"text","value":".\n\n FAIL  src/App.test.js\n  ● renders without crashing\n\n$ "},{"type":"element","tagName":"span","properties":{"className":["token","builtin","class-name"]},"children":[{"type":"text","value":"echo"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":"$?"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1"}]}]}]},{"type":"text","value":"\n              "}]},{"type":"text","value":"\n            "}]},{"type":"text","value":"\n          \n"},{"type":"element","tagName":"h3","properties":{"id":"docker-for-development","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#docker-for-development","ariaLabel":"docker for development permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"Docker for development"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"It is also possible to use docker for development. This is useful when you wish for all developers to have the same development environment, and as close to production as possible."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"We can modify the "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"docker-compose.yml"}]},{"type":"text","value":" file to have an additional "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"dev"}]},{"type":"text","value":" service:"}]},{"type":"text","value":"\n\n            "},{"type":"element","tagName":"div","properties":{"className":["code-snippet"]},"children":[{"type":"text","value":"\n              \n              "},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"]},"children":[{"type":"text","value":"\n                "},{"type":"element","tagName":"pre","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"version"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'3'"}]},{"type":"text","value":"\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"services"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"dev"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"build"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"context"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" .\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"ports"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" 3000"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"3000"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"command"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" npm start\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"volumes"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"./src:/srv/example/src\""}]},{"type":"text","value":"\n\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"test"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"build"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"context"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" .\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"environment"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" CI=true\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"command"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" npm test"}]}]},{"type":"text","value":"\n              "}]},{"type":"text","value":"\n            "}]},{"type":"text","value":"\n          \n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"This adds an additional "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"dev"}]},{"type":"text","value":" service which will run "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"npm start"}]},{"type":"text","value":", and expose port 3000 within the docker container onto port 3000 on the host machine."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"An important addition is the "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"volumes"}]},{"type":"text","value":" keys, which maps the current host machine's src directory onto "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"/srv/example/src"}]},{"type":"text","value":" within the docker container. This means that any local file changes will reflected within our docker container. This is useful as by default the "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"create-react-app"}]},{"type":"text","value":" has hot module reloading enabled, and any code changes made on the host machine will automatically reload your browser."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"We can run this container with:"}]},{"type":"text","value":"\n\n            "},{"type":"element","tagName":"div","properties":{"className":["code-snippet"]},"children":[{"type":"text","value":"\n              \n              "},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"]},"children":[{"type":"text","value":"\n                "},{"type":"element","tagName":"pre","properties":{"className":["language-bash"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-bash"]},"children":[{"type":"text","value":"$ "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"docker-compose"}]},{"type":"text","value":" build dev\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":".."}]},{"type":"text","value":".\n\n$ "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"docker-compose"}]},{"type":"text","value":" up dev\n\nCreating myapp_dev_1\nAttaching to myapp_dev_1\ndev_1   "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"|"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"npm"}]},{"type":"text","value":" info it worked "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"if"}]},{"type":"text","value":" it ends with ok\ndev_1   "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"|"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"npm"}]},{"type":"text","value":" info using npm@5.0.0\ndev_1   "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"|"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"npm"}]},{"type":"text","value":" info using node@v8.0.0\ndev_1   "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"|"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"npm"}]},{"type":"text","value":" info lifecycle my-app@0.1.0~prestart: my-app@0.1.0\ndev_1   "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"|"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"npm"}]},{"type":"text","value":" info lifecycle my-app@0.1.0~start: my-app@0.1.0\ndev_1   "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"|"}]},{"type":"text","value":"\ndev_1   "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"|"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":">"}]},{"type":"text","value":" my-app@0.1.0 start /srv/example\ndev_1   "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"|"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":">"}]},{"type":"text","value":" react-scripts start\ndev_1   "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"|"}]},{"type":"text","value":"\ndev_1   "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"|"}]},{"type":"text","value":" Starting the development server"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":".."}]},{"type":"text","value":".\ndev_1   "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"|"}]},{"type":"text","value":"\ndev_1   "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"|"}]},{"type":"text","value":" Compiled successfully"},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"!"}]},{"type":"text","value":"\ndev_1   "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"|"}]},{"type":"text","value":"\ndev_1   "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"|"}]},{"type":"text","value":" You can now view my-app "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"in"}]},{"type":"text","value":" the browser.\ndev_1   "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"|"}]},{"type":"text","value":"\ndev_1   "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"|"}]},{"type":"text","value":"   Local:            http://localhost:3000/\ndev_1   "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"|"}]},{"type":"text","value":"   On Your Network:  http://172.20.0.2:3000/\ndev_1   "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"|"}]},{"type":"text","value":"\ndev_1   "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"|"}]},{"type":"text","value":" Note that the development build is not optimized.\ndev_1   "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"|"}]},{"type":"text","value":" To create a production build, use "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"yarn"}]},{"type":"text","value":" run build.\ndev_1   "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"|"}]}]}]},{"type":"text","value":"\n              "}]},{"type":"text","value":"\n            "}]},{"type":"text","value":"\n          \n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Note that we are making use of "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"docker-compose up"}]},{"type":"text","value":" rather than the previous "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"run"}]},{"type":"text","value":" command."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{"id":"create-a-makefile","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#create-a-makefile","ariaLabel":"create a makefile permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"Create a makefile"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"It's never fun to remember arbitrary commands. Let's introduce a makefile to streamline the dev process:"}]},{"type":"text","value":"\n\n            "},{"type":"element","tagName":"div","properties":{"className":["code-snippet"]},"children":[{"type":"text","value":"\n              \n              "},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"]},"children":[{"type":"text","value":"\n                "},{"type":"element","tagName":"pre","properties":{"className":["language-bash"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-bash"]},"children":[{"type":"text","value":".PHONY: dev "},{"type":"element","tagName":"span","properties":{"className":["token","builtin","class-name"]},"children":[{"type":"text","value":"test"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","builtin","class-name"]},"children":[{"type":"text","value":"help"}]},{"type":"text","value":"\n.DEFAULT_GOAL: "},{"type":"element","tagName":"span","properties":{"className":["token","builtin","class-name"]},"children":[{"type":"text","value":"help"}]},{"type":"text","value":"\n\ndefault: "},{"type":"element","tagName":"span","properties":{"className":["token","builtin","class-name"]},"children":[{"type":"text","value":"help"}]},{"type":"text","value":"\n\nhelp: "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"## Output available commands"}]},{"type":"text","value":"\n\t@echo "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"Available commands:\""}]},{"type":"text","value":"\n\t@echo\n\t@fgrep "},{"type":"element","tagName":"span","properties":{"className":["token","parameter","variable"]},"children":[{"type":"text","value":"-h"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"##\""}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":"$("}]},{"type":"text","value":"MAKEFILE_LIST"},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":")"}]}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"|"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"fgrep"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","parameter","variable"]},"children":[{"type":"text","value":"-v"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"fgrep"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"|"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"sed"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","parameter","variable"]},"children":[{"type":"text","value":"-e"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'s/\\\\$$//'"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"|"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"sed"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","parameter","variable"]},"children":[{"type":"text","value":"-e"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'s/##//'"}]},{"type":"text","value":"\n\ndev:  "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"## Run a development environment on port 3000"}]},{"type":"text","value":"\n\t@docker-compose build dev\n\t@docker-compose up dev\n\ntest: "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"## Run the current test suite"}]},{"type":"text","value":"\n\t@docker-compose build "},{"type":"element","tagName":"span","properties":{"className":["token","builtin","class-name"]},"children":[{"type":"text","value":"test"}]},{"type":"text","value":"\n\t@docker-compose run "},{"type":"element","tagName":"span","properties":{"className":["token","parameter","variable"]},"children":[{"type":"text","value":"--rm"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","builtin","class-name"]},"children":[{"type":"text","value":"test"}]}]}]},{"type":"text","value":"\n              "}]},{"type":"text","value":"\n            "}]},{"type":"text","value":"\n          \n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"Note"}]},{"type":"text","value":": Makefiles should use tabs, rather than spaces."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"If we're unsure what commands are available to us, we can just run "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"make help"}]},{"type":"text","value":":"}]},{"type":"text","value":"\n\n            "},{"type":"element","tagName":"div","properties":{"className":["code-snippet"]},"children":[{"type":"text","value":"\n              \n              "},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"]},"children":[{"type":"text","value":"\n                "},{"type":"element","tagName":"pre","properties":{"className":["language-bash"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-bash"]},"children":[{"type":"text","value":"Available commands:\n\nhelp:  Output available commands\ndev:   Run a development environment on port "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"3000"}]},{"type":"text","value":"\ntest:  Run the current "},{"type":"element","tagName":"span","properties":{"className":["token","builtin","class-name"]},"children":[{"type":"text","value":"test"}]},{"type":"text","value":" suite"}]}]},{"type":"text","value":"\n              "}]},{"type":"text","value":"\n            "}]},{"type":"text","value":"\n          \n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"For instance, to run the test target you can use:"}]},{"type":"text","value":"\n\n            "},{"type":"element","tagName":"div","properties":{"className":["code-snippet"]},"children":[{"type":"text","value":"\n              \n              "},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"]},"children":[{"type":"text","value":"\n                "},{"type":"element","tagName":"pre","properties":{"className":["language-bash"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-bash"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"make"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","builtin","class-name"]},"children":[{"type":"text","value":"test"}]}]}]},{"type":"text","value":"\n              "}]},{"type":"text","value":"\n            "}]},{"type":"text","value":"\n          \n"},{"type":"element","tagName":"h3","properties":{"id":"sources","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#sources","ariaLabel":"sources permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"Sources"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The full source code can be found at "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/AlanFoster/create-react-app-docker-unit-tests"},"children":[{"type":"text","value":"create-react-app-docker-unit-tests"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{"id":"additional-useful-docker-commands","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#additional-useful-docker-commands","ariaLabel":"additional useful docker commands permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"Additional useful Docker commands"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"To view all of the currently running docker instances:"}]},{"type":"text","value":"\n\n            "},{"type":"element","tagName":"div","properties":{"className":["code-snippet"]},"children":[{"type":"text","value":"\n              \n              "},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"]},"children":[{"type":"text","value":"\n                "},{"type":"element","tagName":"pre","properties":{"className":["language-bash"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-bash"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"docker"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"ps"}]}]}]},{"type":"text","value":"\n              "}]},{"type":"text","value":"\n            "}]},{"type":"text","value":"\n          \n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"To open an interactive terminal into one of your running instances:"}]},{"type":"text","value":"\n\n            "},{"type":"element","tagName":"div","properties":{"className":["code-snippet"]},"children":[{"type":"text","value":"\n              \n              "},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"]},"children":[{"type":"text","value":"\n                "},{"type":"element","tagName":"pre","properties":{"className":["language-bash"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-bash"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"docker"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","builtin","class-name"]},"children":[{"type":"text","value":"exec"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","parameter","variable"]},"children":[{"type":"text","value":"-it"}]},{"type":"text","value":" DOCKER_PID /bin/sh"}]}]},{"type":"text","value":"\n              "}]},{"type":"text","value":"\n            "}]},{"type":"text","value":"\n          \n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"To create a temporary docker container, enter a shell, then delete the container after:"}]},{"type":"text","value":"\n\n            "},{"type":"element","tagName":"div","properties":{"className":["code-snippet"]},"children":[{"type":"text","value":"\n              \n              "},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"]},"children":[{"type":"text","value":"\n                "},{"type":"element","tagName":"pre","properties":{"className":["language-bash"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-bash"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"docker"}]},{"type":"text","value":" run "},{"type":"element","tagName":"span","properties":{"className":["token","parameter","variable"]},"children":[{"type":"text","value":"-it"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","parameter","variable"]},"children":[{"type":"text","value":"--rm"}]},{"type":"text","value":" IMAGE_NAME /bin/sh"}]}]},{"type":"text","value":"\n              "}]},{"type":"text","value":"\n            "}]},{"type":"text","value":"\n          \n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"To view the available docker logs:"}]},{"type":"text","value":"\n\n            "},{"type":"element","tagName":"div","properties":{"className":["code-snippet"]},"children":[{"type":"text","value":"\n              \n              "},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"]},"children":[{"type":"text","value":"\n                "},{"type":"element","tagName":"pre","properties":{"className":["language-bash"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-bash"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"docker"}]},{"type":"text","value":" logs "},{"type":"element","tagName":"span","properties":{"className":["token","parameter","variable"]},"children":[{"type":"text","value":"-f"}]},{"type":"text","value":" DOCKER_PID"}]}]},{"type":"text","value":"\n              "}]},{"type":"text","value":"\n            "}]},{"type":"text","value":"\n          "}],"data":{"quirksMode":false}}}},"pageContext":{"slug":"/posts/running-react-unit-tests-within-docker/"}},"staticQueryHashes":[]}