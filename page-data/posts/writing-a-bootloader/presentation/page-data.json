{"componentChunkName":"component---src-templates-post-presentation-index-js","path":"/posts/writing-a-bootloader/presentation","result":{"data":{"content":{"id":"d053a0af-0631-5927-a999-d027780b6a21","frontmatter":{"title":"Writing a simple x86 BIOS bootloader","workshop":null,"date":"01 December, 2019"},"fields":{"slug":"/posts/writing-a-bootloader/"},"htmlAst":{"type":"root","children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"This article explains how to write a very simple x86 bootloader script which can be used as the entry point to running a custom operating system. It assumes some knowledge of assembly, but hopefully all required knowledge should be available within this stand-alone article."}]},{"type":"text","value":"\n"},{"type":"comment","value":" end-excerpt "},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{"id":"boot-process","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#boot-process","ariaLabel":"boot process permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"Boot Process"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"When an x86 computer turns on, it executes firmware located in motherboard ROM."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"There are two main firmware standards:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"BIOS - \"Basic Input/Output System\" - Older, simpler, but widely supported"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"UEFI - \"Unified Extensible Firmware Interface\" - Modern, with more features"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"This article will describe in detail how to write a BIOS bootloader, and does not discuss UEFI."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{"id":"bios-boot","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#bios-boot","ariaLabel":"bios boot permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"BIOS Boot"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"When an x86 cpu boots, the BIOS is loaded from firmware into memory. It performs various operations such as RAM detection, and other hardware detection/initializations - before finally attempting its boot sequence. During the boot sequence, the BIOS attempts to find a boot disk which will load the operating system - via a "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"bootstrap"}]},{"type":"text","value":" program."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The BIOS generally checks for bootable disks in a specific order. This is potentially user-configurable, known as its bootdisk hierarchy. For instance, checking in the order: floppy disks, CD-ROM drive, then the first hard drive. The BIOS may handle each disk medium differently. For floppy disks the first 512 bytes are read into memory at a specific location, but extra steps may be required for hard drives which contain master boot record information, and CD-ROMs can be loaded entirely into memory and used as a RAM disk. Regardless of medium, the bootloader script will eventually be loaded at address 0x7C00."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"As the BIOS iterates through the disk hierarchy it attempts find the "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"first readable 512 bytes"}]},{"type":"text","value":" (called its "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"boot sector"}]},{"type":"text","value":") which ends with the "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"magic number 0xAA55"}]},{"type":"text","value":". Once found, the BIOS now gives control to the code which has been copied at address location 0x7C00."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Why the magic number 0xAA55? This the binary equivalent: 101010100101010. This may also be used to determine if your system is big endian or little endian - as it will read as either 0xAA55 or 0x55AA."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{"id":"environment","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#environment","ariaLabel":"environment permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"Environment"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"When the BIOS hands over control to your bootloader, the CPU is in 16-bit Real Mode, and the program counter will be running at physical address 0x7c00. Real mode was the only mode before the 80286 Intel processor which introduced protected mode. All processors initially run in real mode, for backwards compatibility purposes."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"In "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"real mode"}]},{"type":"text","value":" you can:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Access BIOS subroutines"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Access 16 bits"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"The CPU can only access 1mb of data"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"In "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"protected mode"}]},{"type":"text","value":" you can:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Use paging, and virtual memory"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Access 32 bits"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Prevent illegal writes to other program's memory that are running at the same time"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Register fault handlers for faulting programs"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Access four privilege levels. Ring 0 being the most unrestricted, and ring 3 being the most restricted"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h4","properties":{"id":"simple-bootloader-example","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#simple-bootloader-example","ariaLabel":"simple bootloader example permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"Simple Bootloader example"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The following examples are written using the nasm assembler."}]},{"type":"text","value":"\n\n            "},{"type":"element","tagName":"div","properties":{"className":["code-snippet"]},"children":[{"type":"text","value":"\n              \n              "},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"]},"children":[{"type":"text","value":"\n                "},{"type":"element","tagName":"pre","properties":{"className":["language-bash"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-bash"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"apt-get"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"install"}]},{"type":"text","value":" nasm"}]}]},{"type":"text","value":"\n              "}]},{"type":"text","value":"\n            "}]},{"type":"text","value":"\n          \n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Create a new file called "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"boot.asm"}]},{"type":"text","value":":"}]},{"type":"text","value":"\n\n            "},{"type":"element","tagName":"div","properties":{"className":["code-snippet"]},"children":[{"type":"text","value":"\n              \n              "},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"]},"children":[{"type":"text","value":"\n                "},{"type":"element","tagName":"pre","properties":{"className":["language-nasm"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-nasm"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"; Simple bootloader example for x86 systems that should print out a simple message to the user"}]},{"type":"text","value":"\n\nbits "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"16"}]},{"type":"text","value":"     "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"; We're dealing with 16 bit code"}]},{"type":"text","value":"\norg "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"0x7c00"}]},{"type":"text","value":"  "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"; Inform the assembler of the starting location for this code"}]},{"type":"text","value":"\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","label","function"]},"children":[{"type":"text","value":"boot:"}]},{"type":"text","value":"\n    mov "},{"type":"element","tagName":"span","properties":{"className":["token","register","variable"]},"children":[{"type":"text","value":"si"}]},{"type":"text","value":", message "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"; Point SI register to message"}]},{"type":"text","value":"\n    mov "},{"type":"element","tagName":"span","properties":{"className":["token","register","variable"]},"children":[{"type":"text","value":"ah"}]},{"type":"text","value":", "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"0x0e"}]},{"type":"text","value":"    "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"; Set higher bits to the display character command"}]},{"type":"text","value":"\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","label","function"]},"children":[{"type":"text","value":".loop:"}]},{"type":"text","value":"\n    lodsb       "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"; Load the character within the AL register, and increment SI"}]},{"type":"text","value":"\n    cmp "},{"type":"element","tagName":"span","properties":{"className":["token","register","variable"]},"children":[{"type":"text","value":"al"}]},{"type":"text","value":", "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"0"}]},{"type":"text","value":"   "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"; Is the AL register a null byte?"}]},{"type":"text","value":"\n    je halt     "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"; Jump to halt"}]},{"type":"text","value":"\n    int "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"0x10"}]},{"type":"text","value":"    "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"; Trigger video services interrupt"}]},{"type":"text","value":"\n    jmp .loop   "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"; Loop again"}]},{"type":"text","value":"\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","label","function"]},"children":[{"type":"text","value":"halt:"}]},{"type":"text","value":"\n    hlt         "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"; Stop"}]},{"type":"text","value":"\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","label","function"]},"children":[{"type":"text","value":"message:"}]},{"type":"text","value":"\n    db "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"Howdy!\""}]},{"type":"text","value":", "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"0"}]},{"type":"text","value":"\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"; Mark the device as bootable"}]},{"type":"text","value":"\ntimes "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"510"}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"("},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"$"}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"-"}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"$"}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"$"}]},{"type":"text","value":") db "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"0"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"; Add any additional zeroes to make 510 bytes in total"}]},{"type":"text","value":"\ndw "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"0xAA55"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"; Write the final 2 bytes as the magic number 0x55aa, remembering x86 little endian"}]}]}]},{"type":"text","value":"\n              "}]},{"type":"text","value":"\n            "}]},{"type":"text","value":"\n          \n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"You can compile the above assembly with:"}]},{"type":"text","value":"\n\n            "},{"type":"element","tagName":"div","properties":{"className":["code-snippet"]},"children":[{"type":"text","value":"\n              \n              "},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"]},"children":[{"type":"text","value":"\n                "},{"type":"element","tagName":"pre","properties":{"className":["language-bash"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-bash"]},"children":[{"type":"text","value":"nasm -f bin boot.asm -o boot.bin"}]}]},{"type":"text","value":"\n              "}]},{"type":"text","value":"\n            "}]},{"type":"text","value":"\n          \n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"At the heart of the above bootloader are various calls to the BIOS to request printing characters to the screen.\nA simplified example of printing to the screen can be shown:"}]},{"type":"text","value":"\n\n            "},{"type":"element","tagName":"div","properties":{"className":["code-snippet"]},"children":[{"type":"text","value":"\n              \n              "},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"]},"children":[{"type":"text","value":"\n                "},{"type":"element","tagName":"pre","properties":{"className":["language-nasm"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-nasm"]},"children":[{"type":"text","value":"mov "},{"type":"element","tagName":"span","properties":{"className":["token","register","variable"]},"children":[{"type":"text","value":"ah"}]},{"type":"text","value":", "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"0x0e"}]},{"type":"text","value":"    "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"; Set higher bits to the display character command"}]},{"type":"text","value":"\nmov "},{"type":"element","tagName":"span","properties":{"className":["token","register","variable"]},"children":[{"type":"text","value":"al"}]},{"type":"text","value":", "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'a'"}]},{"type":"text","value":"     "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"; Set the lower bits to our character"}]},{"type":"text","value":"\nint "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"0x10"}]},{"type":"text","value":"        "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"; Call BIOS video service interrupt, which will output 'a'"}]}]}]},{"type":"text","value":"\n              "}]},{"type":"text","value":"\n            "}]},{"type":"text","value":"\n          \n"},{"type":"element","tagName":"h3","properties":{"id":"emulating-x86-hardware","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#emulating-x86-hardware","ariaLabel":"emulating x86 hardware permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"Emulating x86 hardware"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"It's possible to write the compiled binary above to a disk, and attach it to a real computer. It can instead be easier to make use of x86 emulators, such as "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"Bochs"}]},{"type":"text","value":" or "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"Qemu"}]},{"type":"text","value":". These emulators will do exactly everything that a real computer would do, but everything is "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"simulated using software"}]},{"type":"text","value":" instead of hardware."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h4","properties":{"id":"qemu","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#qemu","ariaLabel":"qemu permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"Qemu"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Firstly install qemu:"}]},{"type":"text","value":"\n\n            "},{"type":"element","tagName":"div","properties":{"className":["code-snippet"]},"children":[{"type":"text","value":"\n              \n              "},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"]},"children":[{"type":"text","value":"\n                "},{"type":"element","tagName":"pre","properties":{"className":["language-bash"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-bash"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"apt-get"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"install"}]},{"type":"text","value":" qemu qemu-kvm"}]}]},{"type":"text","value":"\n              "}]},{"type":"text","value":"\n            "}]},{"type":"text","value":"\n          \n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Within the same directory as your code:"}]},{"type":"text","value":"\n\n            "},{"type":"element","tagName":"div","properties":{"className":["code-snippet"]},"children":[{"type":"text","value":"\n              \n              "},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"]},"children":[{"type":"text","value":"\n                "},{"type":"element","tagName":"pre","properties":{"className":["language-bash"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-bash"]},"children":[{"type":"text","value":"nasm -f bin boot.asm -o boot.bin\nqemu-system-x86_64 -fda boot.bin"}]}]},{"type":"text","value":"\n              "}]},{"type":"text","value":"\n            "}]},{"type":"text","value":"\n          \n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"After running you should see the simple message appear:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; "},"children":[{"type":"text","value":"\n      "},{"type":"element","tagName":"a","properties":{"className":["gatsby-resp-image-link"],"href":"/static/3989d9f475946ae5608481afa2633488/073e9/howdy-qemu.png","style":"display: block","target":"_blank","rel":["noopener"]},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 62.576687116564415%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA1UlEQVQ4y+2RyWqGQBCE3cF915dVURDx3TyoiNvTVFINhuSWkP+QQwY+qqnp6YVR5nnGuq7Ytg33feO6LuE4DmHfdzCH+nifOc8Ty7II0zRBqesaTdOg6zoMw4BxHNH3Peg/8I45VVV9QP+JeUfatoXyfvBSPM8DcRwHYRhKHEWRxNQkSRAEgRDHMYqiEC9NU2RZJkr4TtM0KIZhwDRNwbIs0V9NyOrsmuc5yrKUbr7vw3Vd6crYtu3vF+TYXJdwRV3XvySoqvqzCbnmiz9G+S/4xwq+ARPDWPu5Gu3AAAAAAElFTkSuQmCC'); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n  "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"alt":"howdy qemu","title":"Example of howdy! being rendered to the qemu emulator","src":"/static/3989d9f475946ae5608481afa2633488/a6d36/howdy-qemu.png","srcSet":["/static/3989d9f475946ae5608481afa2633488/222b7/howdy-qemu.png 163w","/static/3989d9f475946ae5608481afa2633488/ff46a/howdy-qemu.png 325w","/static/3989d9f475946ae5608481afa2633488/a6d36/howdy-qemu.png 650w","/static/3989d9f475946ae5608481afa2633488/073e9/howdy-qemu.png 719w"],"sizes":["(max-width:","650px)","100vw,","650px"],"style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;","loading":"lazy"},"children":[]},{"type":"text","value":"\n  "}]},{"type":"text","value":"\n    "}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h4","properties":{"id":"bochs","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#bochs","ariaLabel":"bochs permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"Bochs"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Firstly install bochs:"}]},{"type":"text","value":"\n\n            "},{"type":"element","tagName":"div","properties":{"className":["code-snippet"]},"children":[{"type":"text","value":"\n              \n              "},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"]},"children":[{"type":"text","value":"\n                "},{"type":"element","tagName":"pre","properties":{"className":["language-bash"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-bash"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"apt-get"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"install"}]},{"type":"text","value":" bochs bochs-x"}]}]},{"type":"text","value":"\n              "}]},{"type":"text","value":"\n            "}]},{"type":"text","value":"\n          \n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Within the same directory as your code, create a file "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"bochsrc.txt"}]},{"type":"text","value":":"}]},{"type":"text","value":"\n\n            "},{"type":"element","tagName":"div","properties":{"className":["code-snippet"]},"children":[{"type":"text","value":"\n              \n              "},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"]},"children":[{"type":"text","value":"\n                "},{"type":"element","tagName":"pre","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"megs"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"32"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"romimage"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" file=/usr/share/bochs/BIOS"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"bochs"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"latest"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" address=0xfffe0000\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"vgaromimage"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" file=/usr/share/bochs/VGABIOS"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"lgpl"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"latest\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"floppya"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" 1_44=boot.bin"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" status=inserted\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"boot"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" a\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"log"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" bochsout.txt\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"logprefix"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" %t"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"%e"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"@%i"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"%d\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"mouse"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" enabled=0\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"display_library"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" x"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" options=\"gui_debug\""}]}]},{"type":"text","value":"\n              "}]},{"type":"text","value":"\n            "}]},{"type":"text","value":"\n          \n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Now you can run:"}]},{"type":"text","value":"\n\n            "},{"type":"element","tagName":"div","properties":{"className":["code-snippet"]},"children":[{"type":"text","value":"\n              \n              "},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"]},"children":[{"type":"text","value":"\n                "},{"type":"element","tagName":"pre","properties":{"className":["language-bash"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-bash"]},"children":[{"type":"text","value":"nasm -f bin boot.asm -o boot.bin\nbochs"}]}]},{"type":"text","value":"\n              "}]},{"type":"text","value":"\n            "}]},{"type":"text","value":"\n          \n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"After running you should see the simple message appear:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; "},"children":[{"type":"text","value":"\n      "},{"type":"element","tagName":"a","properties":{"className":["gatsby-resp-image-link"],"href":"/static/3103c6858bbc5a1ee08d0b355b946bfe/073e9/howdy-bochs.png","style":"display: block","target":"_blank","rel":["noopener"]},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 66.87116564417178%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB0ElEQVQ4y6WRS04CQRRFq4tf003zkyb8jcapGyABoSFxDQ6YmsDIIRImhB24A0YoToRE4xoYEkJEEkUgzo0LuL7qVsRP/A5O3qvq6lv3vmKTqysIron7+RyPDw+Y391hNp2+qdObG8xubzGfzTAYDDAajTAejzEcDrFYLDCZTNDv98H29vdRqlRwUK/jqNVC5+IC7V4Px92uBfXtszOcnJ/j9PISrU4HtcNDNJtNlMtllEol1Go1NBoNVKtVMB6NgkcisKdSYMEgmMtloShgmgbm81m932/B2NdoW1vQNjehrq9DTSSgkLgaj0NNJiGvrUGiQ6twSQLn3ESiXnq3Zk5y6CIBmQTcJOre2IBMVawV6rksf+9qFR+5EKgUxxMIwEuxA+EwPF4vHG43uN1uHjRvFw6f3bxgs9lMloJJihkmAT0UQjwWQ4wcJ8hxlKroQ7Rvftd1a4/OKDRTF81ZVI3mrKrqq6CdHIgbRH3B4XAs57OKcPRtZD9F9dFLeimi6IMUWdz8q7mtIiIEaHZOp3MZ489igk+j2Sga//gAP4H9y81nZDIZpNNpZLNZFItF7BZ3sZ3fhr6jw9gxzP1cLgfDMJDP5836vi8UCua/oj4BIIB1uzgIvbkAAAAASUVORK5CYII='); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n  "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"alt":"howdy bochs","title":"Example of howdy! being rendered to the bochs emulator","src":"/static/3103c6858bbc5a1ee08d0b355b946bfe/a6d36/howdy-bochs.png","srcSet":["/static/3103c6858bbc5a1ee08d0b355b946bfe/222b7/howdy-bochs.png 163w","/static/3103c6858bbc5a1ee08d0b355b946bfe/ff46a/howdy-bochs.png 325w","/static/3103c6858bbc5a1ee08d0b355b946bfe/a6d36/howdy-bochs.png 650w","/static/3103c6858bbc5a1ee08d0b355b946bfe/073e9/howdy-bochs.png 719w"],"sizes":["(max-width:","650px)","100vw,","650px"],"style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;","loading":"lazy"},"children":[]},{"type":"text","value":"\n  "}]},{"type":"text","value":"\n    "}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{"id":"entering-protected-mode","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#entering-protected-mode","ariaLabel":"entering protected mode permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"Entering protected mode"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"To enter protected mode you must:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Register 3 entries in the GDT (Global Descriptor Table)"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"null descriptor"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"code segment descriptor"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"data segment descriptor"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Set the protected mode bit within the control register, "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"CR0"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Enable the A20 line, or addressing line 20, so that the CPU can access beyond 1mb of data"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"lgdt"}]},{"type":"text","value":" instruction takes a pointer to a structure in memory that is composed of two parts:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"size (2 bytes)"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"offset (4 bytes)"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Each entry within the GDT is 8-bytes. A simple overview can be found on the osdev wiki - "},{"type":"element","tagName":"a","properties":{"href":"https://wiki.osdev.org/Global_Descriptor_Table"},"children":[{"type":"text","value":"Global Descriptor Table"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{"id":"x86nasm-cheat-sheet","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#x86nasm-cheat-sheet","ariaLabel":"x86nasm cheat sheet permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"x86/nasm Cheat sheet"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"Register names"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ol","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Accumulator Register (AX)"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Counter Register (CX)"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Data Register (DX)"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Base Register (DX)"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Stack Pointer (SP)"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Stack base Pointer (BP)"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Source Index (SI)"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Destination Index (DI)"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"Global Descriptor Table"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Supplied by the kernel"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Defines the various memory segments, what their size is, what they can access, what level they are"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"Interrupt Descriptor Table"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Supplied by the kernel"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Used to map interrupt vectors to functions, which handle events. i.e. Keydown"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"String instructions"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"The first three letters specify what the instruction, the suffix "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"S"}]},{"type":"text","value":" stands for String - MOVS, LODS, STOS, CMPS, SCAS."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"LOD - Load data from the string pointed to ESI into EAX"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"STO - Store data from EAX into the string pointed to by EDI"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"SCA - Scans the data in the string pointed to by EDI to EAX"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"ESI and DSI are incremented if the direction flag is set, otherwise decremented"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"BIOS Calls"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Generally set the AH register"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Call the required interrupt, i.e. "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"int 0x10"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"No longer available in protected mode"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"Labels"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"A global label is defined as "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"name:"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"A label prefixed with "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"."}]},{"type":"text","value":" is local to the above global label, i.e. "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":".loop"}]}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"Pseudo-instructions"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"DB, DW, DD, DQ, DT, DO, DY and DZ declare initialized data in the output file."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"$ evaluates to the assembly position at the beginning of the line containing the expression"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"$$ evaluates to the beginning of the current section; so you can tell how far into the section you are by using ($-$$)"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{"id":"useful-links","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#useful-links","ariaLabel":"useful links permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":" Useful links"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"http://joebergeron.io/posts/post_two.html"},"children":[{"type":"text","value":"Writing a Tiny x86 Bootloader"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://ocw.mit.edu/courses/electrical-engineering-and-computer-science/6-828-operating-system-engineering-fall-2012/index.htm"},"children":[{"type":"text","value":"MIT Operating System Engineering"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://os.phil-opp.com/"},"children":[{"type":"text","value":"Writing a Rust OS"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://nasm.us/doc/nasmdoc3.html"},"children":[{"type":"text","value":"Nasm overview"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://en.wikibooks.org/wiki/X86_Assembly/Bootloaders"},"children":[{"type":"text","value":"x86 Bootloader Wiki"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"http://3zanders.co.uk/2017/10/13/writing-a-bootloader/"},"children":[{"type":"text","value":"Writing an x86 bootloader"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://medium.com/@ophirharpaz/a-summary-of-x86-string-instructions-87566a28c20c"},"children":[{"type":"text","value":"Summary of x86 String instructions"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"http://www.roesler-ac.de/wolfram/acro/credits.htm#1"},"children":[{"type":"text","value":"Unix Acronym List"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://en.wikipedia.org/wiki/BIOS_interrupt_call"},"children":[{"type":"text","value":"Available x86 BIOS calls"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://en.wikibooks.org/wiki/X86_Assembly/X86_Architecture"},"children":[{"type":"text","value":"x86 Registers"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://www.cs.bham.ac.uk/~exr/lectures/opsys/10_11/lectures/os-dev.pdf"},"children":[{"type":"text","value":"OS Dev - Writing a simple operating system from scratch"}]}]},{"type":"text","value":"\n"}]}],"data":{"quirksMode":false}}}},"pageContext":{"slug":"/posts/writing-a-bootloader/"}},"staticQueryHashes":[]}