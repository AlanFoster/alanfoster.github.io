{"componentChunkName":"component---src-templates-post-index-js","path":"/posts/testing-approaches-in-ruby/","result":{"data":{"markdownRemark":{"html":"<p>The first part half of this post will discuss an overview of different testing techniques and approaches that you can use within your development cycle to improve code quality. Followed by some useful RSpec snippets and patterns when leveraging RSpec for testing your Ruby code.</p>\n<!-- end-excerpt -->\n<h1 id=\"why-test\" style=\"position:relative;\"><a href=\"#why-test\" aria-label=\"why test permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Why test?</h1>\n<p>There's lots of reasons to write tests as part of the development cycle of software, including but not limited to:</p>\n<ul>\n<li>Encourages the developer to think about edge-cases and fix bugs</li>\n<li>Catch regression issues before your users find them</li>\n<li>Invaluable when upgrading third-party libraries</li>\n<li>Useful when onboarding new developers/maintaining old code</li>\n<li>Traceability to requirements</li>\n</ul>\n<h2 id=\"types-of-tests\" style=\"position:relative;\"><a href=\"#types-of-tests\" aria-label=\"types of tests permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Types of tests</h2>\n<p>Different testing frameworks use different terminology, but in general the types of tests that a developer will often include the following concepts</p>\n<h3 id=\"unit-tests\" style=\"position:relative;\"><a href=\"#unit-tests\" aria-label=\"unit tests permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Unit tests</h3>\n<p>Unit tests, or component testing, will <strong>test easily separable functions/modules in isolation</strong>. These tests are <strong>fast to run</strong>, and often fast to write. Often useful when testing standalone algorithms and objects with complex business logic which must be verified thoroughly.</p>\n\n            <div class=\"code-snippet\">\n              \n              <div class=\"gatsby-highlight\">\n                <pre class=\"language-ruby\"><code class=\"language-ruby\">calculator_result <span class=\"token operator\">=</span> calculator<span class=\"token punctuation\">.</span>add<span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">5</span><span class=\"token punctuation\">)</span>\nexpect<span class=\"token punctuation\">(</span>calculator_result<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to eq<span class=\"token punctuation\">(</span><span class=\"token number\">7</span><span class=\"token punctuation\">)</span></code></pre>\n              </div>\n            </div>\n          \n<h3 id=\"integration-tests\" style=\"position:relative;\"><a href=\"#integration-tests\" aria-label=\"integration tests permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Integration tests</h3>\n<p>Often done after unit tests are developed. These tests will <strong>verify that multiple modules work together</strong> in harmony. These set of tests can often be <strong>slow</strong> as multiple levels of code and abstraction will execute, potentially making database calls etc.</p>\n\n            <div class=\"code-snippet\">\n              \n              <div class=\"gatsby-highlight\">\n                <pre class=\"language-ruby\"><code class=\"language-ruby\">result <span class=\"token operator\">=</span> some_complex_function_with_database_calls<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nexpect<span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to eq<span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre>\n              </div>\n            </div>\n          \n<h3 id=\"functional--system--end-to-end-tests\" style=\"position:relative;\"><a href=\"#functional--system--end-to-end-tests\" aria-label=\"functional  system  end to end tests permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Functional / System / end-to-end tests</h3>\n<p>These set of tests will <strong>ensure that the full system works</strong> as expected from a user's perspective. This often requires <strong>replicating real user actions through a real browser</strong>.</p>\n<p>There are lots of tools to choose from here, such as <strong><a href=\"https://github.com/teamcapybara/capybara\">Capybara</a></strong>, a Ruby library for testing web applications via a browser:</p>\n\n            <div class=\"code-snippet\">\n              \n              <div class=\"gatsby-highlight\">\n                <pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token keyword\">require</span> <span class=\"token string\">'feature_helper'</span>\n\n<span class=\"token constant\">RSpec</span><span class=\"token punctuation\">.</span>feature <span class=\"token string\">'Blog management'</span> <span class=\"token keyword\">do</span>\n  scenario <span class=\"token string\">'Successfully creating a new blog'</span> <span class=\"token keyword\">do</span>\n    visit <span class=\"token string\">'/blogs'</span>\n\n    fill_in <span class=\"token string\">'blog_title'</span><span class=\"token punctuation\">,</span> with<span class=\"token punctuation\">:</span> <span class=\"token string\">'My Blog Title'</span>\n    fill_in <span class=\"token string\">'blog_text'</span><span class=\"token punctuation\">,</span> with<span class=\"token punctuation\">:</span> <span class=\"token string\">'My new blog text'</span>\n    click_on <span class=\"token string\">'Save Blog'</span>\n\n    expect<span class=\"token punctuation\">(</span>page<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to have_selector<span class=\"token punctuation\">(</span><span class=\"token string\">'.blog--show'</span><span class=\"token punctuation\">)</span>\n    expect<span class=\"token punctuation\">(</span>page<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to have_content<span class=\"token punctuation\">(</span><span class=\"token string\">'My Blog Title'</span><span class=\"token punctuation\">)</span>\n    expect<span class=\"token punctuation\">(</span>page<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to have_content<span class=\"token punctuation\">(</span><span class=\"token string\">'My new blog text'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">end</span>\n<span class=\"token keyword\">end</span></code></pre>\n              </div>\n            </div>\n          \n<p>You may even encounter <strong>Cucumber</strong> or <strong>Gherkin syntax</strong> tests, which is a way of implementing human readable user stories in code:</p>\n\n            <div class=\"code-snippet\">\n              \n              <div class=\"gatsby-highlight\">\n                <pre class=\"language-r\"><code class=\"language-r\">Scenario<span class=\"token operator\">:</span> User adds their first blog post\n  Given the user has no blog posts\n  When the user creates a new blog post with the title <span class=\"token string\">\"My blog title\"</span> and content <span class=\"token string\">\"My blog text\"</span>\n  Then the home page should contain the following blogs<span class=\"token operator\">:</span>\n    <span class=\"token operator\">|</span> id <span class=\"token operator\">|</span> title         <span class=\"token operator\">|</span> content         <span class=\"token operator\">|</span>\n    <span class=\"token operator\">|</span> <span class=\"token number\">1</span>  <span class=\"token operator\">|</span> My blog title <span class=\"token operator\">|</span> My blog content <span class=\"token operator\">|</span></code></pre>\n              </div>\n            </div>\n          \n<p>These stories will take the format of <code>Given / When / Then</code>:</p>\n<ul>\n<li><code>Given</code> - Pre-requisite state that the system must be in (Arrange)</li>\n<li><code>When</code> - When the user performs an action (Act)</li>\n<li><code>Then</code> - Verify the output of the system (Assert)</li>\n</ul>\n<p>Behind the scenes these human readable strings would be implemented programmatically within your language of choice. A runtime library would then glue the various steps together to complete the test:</p>\n\n            <div class=\"code-snippet\">\n              \n              <div class=\"gatsby-highlight\">\n                <pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token constant\">When</span> <span class=\"token operator\">/</span><span class=\"token operator\">^</span>the user creates a <span class=\"token keyword\">new</span> blog post with the title <span class=\"token string\">\"([^\"</span><span class=\"token punctuation\">]</span><span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token string\">\" and content \"</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token operator\">^</span><span class=\"token string\">\"]*)\"</span>$<span class=\"token operator\">/</span> <span class=\"token keyword\">do</span> <span class=\"token operator\">|</span>title<span class=\"token punctuation\">,</span> content<span class=\"token operator\">|</span>\n  visit <span class=\"token string\">'/blogs'</span>\n\n  fill_in <span class=\"token string\">'blog_title'</span><span class=\"token punctuation\">,</span> with<span class=\"token punctuation\">:</span> title\n  fill_in <span class=\"token string\">'blog_text'</span><span class=\"token punctuation\">,</span> with<span class=\"token punctuation\">:</span> content\n\n  click_on <span class=\"token string\">'Save Blog'</span>\n<span class=\"token keyword\">end</span></code></pre>\n              </div>\n            </div>\n          \n<h3 id=\"performance\" style=\"position:relative;\"><a href=\"#performance\" aria-label=\"performance permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Performance</h3>\n<p>Testing non-functional requirements, such as <strong>how many requests per second an API can handle</strong>, or even <strong>how fast a particular particular algorithm or datastructure is</strong>.</p>\n<p><a href=\"https://github.com/evanphx/benchmark-ips\"><strong>benchmark-ips</strong></a> is a useful library which will run a code snippet multiple times, comparing the relative performance of different implementations:</p>\n\n            <div class=\"code-snippet\">\n              \n              <div class=\"gatsby-highlight\">\n                <pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token keyword\">require</span> <span class=\"token string\">'benchmark/ips'</span>\n\n<span class=\"token constant\">Benchmark</span><span class=\"token punctuation\">.</span>ips <span class=\"token keyword\">do</span> <span class=\"token operator\">|</span>x<span class=\"token operator\">|</span>\n  x<span class=\"token punctuation\">.</span>report<span class=\"token punctuation\">(</span><span class=\"token string\">'implementation 1'</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">do</span>\n   <span class=\"token comment\"># ...</span>\n  <span class=\"token keyword\">end</span>\n  x<span class=\"token punctuation\">.</span>report<span class=\"token punctuation\">(</span><span class=\"token string\">'implementation 2'</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">do</span>\n    <span class=\"token comment\"># ...</span>\n  <span class=\"token keyword\">end</span>\n  x<span class=\"token punctuation\">.</span>compare<span class=\"token operator\">!</span>\n<span class=\"token keyword\">end</span></code></pre>\n              </div>\n            </div>\n          \n<p>The library will also figure out how many times to run the code to get interesting data without needing to tweak the loop count manually:</p>\n\n            <div class=\"code-snippet\">\n              \n              <div class=\"gatsby-highlight\">\n                <pre class=\"language-none\"><code class=\"language-none\">Warming up --------------------------------------\n    implementation 1     1.429M i/100ms\n    implementation 2     1.290M i/100ms\nCalculating -------------------------------------\n    implementation 1     13.839M (± 3.7%) i/s -     70.021M in   5.066857s\n    implementation 2     14.529M (± 6.1%) i/s -     73.552M in   5.082248s\n\nComparison:\n    implementation 2: 14528559.1 i/s\n    implementation 1: 13839063.9 i/s - same-ish: difference falls within error</code></pre>\n              </div>\n            </div>\n          \n<h2 id=\"which-tests-should-i-write\" style=\"position:relative;\"><a href=\"#which-tests-should-i-write\" aria-label=\"which tests should i write permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Which tests should I write?</h2>\n<p>Just as there's multiple ways to structure a piece of software, with different advantages and trade-offs, there is multiple ways to structure your test suite.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 500px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/c16a6a12b7b7a6a2a599a7ad35aa0a12/7217d/unit-tests-passing.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 100%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsSAAALEgHS3X78AAAFTklEQVQ4yyWU2VMT1h7H83gf2of7fB/bx05n+gfc2850s860oy1tba3SQbYkhGwY9kVlEQrEhOwLkAXJAgkiEJbgiEslYRMMSQgi1mVGi62Itcv11k+PvQ9nzpk553x+33O+33MkSpkTpdyOwzaIzeLH5x2mvc2NQe/FZvXT9Z0LlyNAyyknxjN++vuGMRo8Yr737/Wh4DjdnS5kRT3Ii61IyqVO1GVWYrEZ4vG4aBdoO9UrIENEoqOiQJBQaJRw4Dy9rjBTk3HGxiYYGTnP5OQ0N1IpAY2gUVhRyhxIKjVuKpROFCVGSvI7RKVOVHIL0sIzojdSV+3jwL4GDuxvpLTI/LcSaaFB9AYKjrRz5ItmpAV6ykrMAmh/CXSiKbehktnQyl9WsQjFNlqavJw6GeXgf5R8+a+3yH9zP3lvqyg4rEet7KWqwo1SQMoLeygrNIv99v8DdWo3OpUDZXEPWqkJbZmZ1qZBNKp+3nr9Wyo+yMP86X76j37Cpr+GqeZy2mV1KITKMqmDGrVD7LGiU7uEEOdLoIsKhQ1dmYVqhYXO5gDfHNLz6j/e4ZM3PqBfJiPeUcOvC0ZIdfHHlI5HQxXMtJRTd1hLweetlBbaqNK6OVHnQ6Itt6ORmjlR6aLtZIh979bwxmv5HP6sllggwP2Lbn652gVbJp7MdbAdaeLhkJJHUR13fWom6kupPqQmP6+VomPC5Uoh+VS9n6baIPv+reKfr7wnwC7cjiAr0wOQsfIi3cMfC3p+mdBx3aYmfbaerWAN94IaHoQr2HTqGK3TUP31cSQdbUM0159loEZD68GDOGsbUEs7CRuFqowF1s7w/ForD6YNbDkKWOs6yqpJzs1+BXcDau4EjnNnoJrlHh2DZVIkVn2AZd8ZdkOFrLgqWB/s5tbQaXFEO2RNPP3eyMNZIxl7MenuA2y789l0y7khoCmzlNt+LfcDOq58V4G7SIbkaSYA6338FFZx72w+857TpIPt/HfNxIs1AyQ6WDIcI9HwIdv2L8lZBdB2jJzpW1a6i1npKuUHr5r4CTW9hSVI2B7gecrD43N13HV9xeWWElY9J/l1ySRcNfPbpJzFto9ZPvERtyx5bJiPkrUVs9pdwDVTJTmHnJzrOFP1CkzH5Ej+FDCyXnanOnkY1HHLX8W8tYHdOWFCvJafQ4dI6fNYbnifnOFTASgiZy9hxSRjwVLFTUc5KVslsToVp8uahMKsn2dJN08TTn4MV3M/VMnNYDM/RqtF3mQ8iR4hbczjRvsBNk1fsWEvFXeoIG0rJWstFQXKWTUfJ3yyCVerAcmTZB+/ZUQ8cgPsRBq541HxbLKOPRGR3VE1e+eKSPfksa7/mnteAXAp2OxTknXKSJuKyApgwtLIiM3GtEd8Dr/nhCnbAf5c87A3o+d2v4bdiUaezTSyN17JzwKaGmhhskXLulC0JeKStkrJCIWrhhIyvTrmPCaSY4MsRL3iyC+BGR9s+Hmx7OKuR8POUBXPZ5vYG6ti54KR329EeXTFz6K7jRWjUjgtImQsFHdbwpqvjXXxAO4nw2zMnkXyv5SPnXkvjxf9PLrsZNlZy0ZQBHmyi5sTPTxYHubx9SB76xF2xHh+0MpFQ6UwREvS0Ugi2sftRIQ7SdHmQ0hebIRZSl5lZibOxdFBLl35nvj4CLGxUYLhIa7NJ7l06RLTsRGxZorxqWnmL89xJRYlOjJCNBJmJjbK7NQYP1wLIslOO4l67STGfeRm+liaGOBqxMXihWGW5kbILsZIJ86zemGA9NUo1+cibCXPcW8hwvJsgNRcmMzlEJuJczxeHeYvHyt3uzrwxHoAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Unit tests passing\"\n        title=\"Unit tests passing\"\n        src=\"/static/c16a6a12b7b7a6a2a599a7ad35aa0a12/7217d/unit-tests-passing.png\"\n        srcset=\"/static/c16a6a12b7b7a6a2a599a7ad35aa0a12/fc8b9/unit-tests-passing.png 163w,\n/static/c16a6a12b7b7a6a2a599a7ad35aa0a12/d53b1/unit-tests-passing.png 325w,\n/static/c16a6a12b7b7a6a2a599a7ad35aa0a12/7217d/unit-tests-passing.png 500w\"\n        sizes=\"(max-width: 500px) 100vw, 500px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p><strong>Unit tests are fast to run</strong>, and are often initially fast to write. Unfortunately as they often stub/mock external dependencies, they may not provide the reassurance that the system will work as a whole. For this reason, it could be suggested that <strong>integration tests provide the most for benefit for their relative cost</strong>. Whilst <strong>end-to-end tests will ensure that user stories work</strong> as expected, they can often be the most flakey.</p>\n<h3 id=\"testing-pyramid\" style=\"position:relative;\"><a href=\"#testing-pyramid\" aria-label=\"testing pyramid permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Testing pyramid</h3>\n<p>You may consider writing a lot of unit tests, which are fast to run. Followed by less integration tests, and an even smaller amount of UI/End to End tests.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 650px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/15fbbe4eea327ffec0c57d67005bdbfd/6c580/testing-pyramid.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 47.08718360787464%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsSAAALEgHS3X78AAABGElEQVQoz32SjW6DMAyEef8n3NQOaAvlJ6FAgEIbwPW5A4WJzpIV40Rfzhc8cmKe53VdaqUL8sMT2XGkXGkKT2dqmmZz3g3vPxgAX98H8oOQjn5A1trNvltvgHsHiuJGUXwV6CWKKc1y+Z6m6aMAAe5taIbluZJVac1rQUmakTENBTz+yON/gnp/G4b9gW9t11FV15JlVVFdG/aulfp8iTZQNz0XBsi971f5msFplsm4UPl4PKX/ZC9l/L1HccdMklSgUIOE2rbtJGtjRO2tLKWPSw7HHxEzsq8QMgzDe2TAcBiBl8QvYu0oYwFcltW7/5tQCHU9Q+JrIpdBDHz2cqXEMwRecMnFCgChGrW7v3jYdXf2NF5HfgHIbLyfASjavgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Testing pyramid\"\n        title=\"Testing pyramid\"\n        src=\"/static/15fbbe4eea327ffec0c57d67005bdbfd/dc2fe/testing-pyramid.png\"\n        srcset=\"/static/15fbbe4eea327ffec0c57d67005bdbfd/fc8b9/testing-pyramid.png 163w,\n/static/15fbbe4eea327ffec0c57d67005bdbfd/d53b1/testing-pyramid.png 325w,\n/static/15fbbe4eea327ffec0c57d67005bdbfd/dc2fe/testing-pyramid.png 650w,\n/static/15fbbe4eea327ffec0c57d67005bdbfd/6251f/testing-pyramid.png 975w,\n/static/15fbbe4eea327ffec0c57d67005bdbfd/72325/testing-pyramid.png 1300w,\n/static/15fbbe4eea327ffec0c57d67005bdbfd/6c580/testing-pyramid.png 2489w\"\n        sizes=\"(max-width: 650px) 100vw, 650px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<h3 id=\"testing-ice-cream-cone\" style=\"position:relative;\"><a href=\"#testing-ice-cream-cone\" aria-label=\"testing ice cream cone permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Testing ice-cream cone</h3>\n<p>The testing ice cream cone can be considered an anti-pattern, as it is often an indication that the manual testing could be migrated to faster automated testing:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 650px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/313cbc6fa15d00d6c7ebcf9eca048419/e7272/testing-cone.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 89.98257839721255%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAAAsSAAALEgHS3X78AAAB7ElEQVQ4y5WUCW/bMAyF/f9/2rauGIouLba1Sdrm8H0fsR1Onxp6ru0UmABGkUw+PT5Scs7ns+jouk6KspQ0y6wlaSppms0sy7Bc6roRjWfGHBZ931sHnHFq21Y+G/jjw+FJkkpVVcM3B1ZxnEhzOs0C9VQ1BZuOPC8sIQsYJ4l0FycN7LrezgTrHv9Pl0MhMfZX0KqqxSHN95P/Mbi7X8nN7Q/58u27PDz+kq83t1aO33+e5H71YNfbl9cBVOcoisVBg2l6MCmNLujZNI1UdW330S0IQstEdRtLwSGO6/lSFOUH3ZbG0v6YHRoeXe9dQxiw0V60+Z9BNrv9QfwgkCzPxeGnNOWnBag2p9B/2hpt29kiYHZt5pOZyQzN8PWNDEhjq6ynHI6ueL5vdfOMs+cHthBRHMvr285+Jzg0IPvD0X5jD+Bx6s5YG9+AaEtwSBBGstm+yBrbbO3tQR4GbN92+5mezngBGMz0tpA+bNGH4DCKrBRU+Xm9HW7UIkOda6MFwWhLurQJRqowzotCfq4ehWJOwWYMx6Cq0fN6Y40eg/3RdQewfvIwfACcghIMIA2MdrXRDuZ6Q/rJdR0eh6Um1f9oFpo0qT6pahGWHo0Z4FLqFAmQsqxkY5jRk0t+VwGv6cmDML27167oXy4nfDyTFe1qAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Testing Code\"\n        title=\"Testing Code\"\n        src=\"/static/313cbc6fa15d00d6c7ebcf9eca048419/dc2fe/testing-cone.png\"\n        srcset=\"/static/313cbc6fa15d00d6c7ebcf9eca048419/fc8b9/testing-cone.png 163w,\n/static/313cbc6fa15d00d6c7ebcf9eca048419/d53b1/testing-cone.png 325w,\n/static/313cbc6fa15d00d6c7ebcf9eca048419/dc2fe/testing-cone.png 650w,\n/static/313cbc6fa15d00d6c7ebcf9eca048419/6251f/testing-cone.png 975w,\n/static/313cbc6fa15d00d6c7ebcf9eca048419/72325/testing-cone.png 1300w,\n/static/313cbc6fa15d00d6c7ebcf9eca048419/e7272/testing-cone.png 2296w\"\n        sizes=\"(max-width: 650px) 100vw, 650px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<h3 id=\"testing-diamond\" style=\"position:relative;\"><a href=\"#testing-diamond\" aria-label=\"testing diamond permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Testing diamond</h3>\n<p>An alternative approach is to favor integration tests as a good middleground solution, balancing the trade-offs between test speed and usefulness:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 650px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/2d1a81dfd1bbb2915ca11c2a50c0f8ac/1afd7/testing-diamond.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 100%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsSAAALEgHS3X78AAABsElEQVQ4y52ViXKCMBCG8/4v12mntdpRuW9EbsUq2/yrMMilNjOZENh82eNPENRrdV23Y/PsOC6Zlj1q029iCtY0x/Uoy3IqypJsx3kIFXMGtvQsTbN2nuU5GQ88FVMf/CCgvCg41HAX0ddiSVtFpfJwIMue9lSMwTw/IMO0SNMNXgxPVU0n3TC5Iw3oY1DRh22kF/AICxbLFY/YACM8/JSe+kF4/f69GkBFF6bJ3RVVpyjaM3S/jykIQ/IlEB3PeO962MSn9UbhKLrQtigIJY4TerWhaN1CMRC77G+wy+XyFAh2jW2aZa2kBGBxD3aQlcT7pjBbReNqY45IkjQdiD/PC86rgBFEewXWLVCVIOQNMBQDdk314yQZAIuivAIxgTRwGl4JuQvDWkjr7qQAilz8pyhdod/JBh8gldPpl8M+VhVV3E934/FY0fl8loWMW88mhb3eKqyvSIIh4N1Nj5gHcu56vtTjjlY/a7adFHb/UmhyCk+QcITW5BeXxFNHrwtFNbEwlN68vX9wtfsFGL0c5q4iw7QH1xeO3cPrax5qUZKkLOY5z0aBc1D0Z34Bf2EqFXdw776TAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Testing Diamond\"\n        title=\"Testing Diamond\"\n        src=\"/static/2d1a81dfd1bbb2915ca11c2a50c0f8ac/dc2fe/testing-diamond.png\"\n        srcset=\"/static/2d1a81dfd1bbb2915ca11c2a50c0f8ac/fc8b9/testing-diamond.png 163w,\n/static/2d1a81dfd1bbb2915ca11c2a50c0f8ac/d53b1/testing-diamond.png 325w,\n/static/2d1a81dfd1bbb2915ca11c2a50c0f8ac/dc2fe/testing-diamond.png 650w,\n/static/2d1a81dfd1bbb2915ca11c2a50c0f8ac/6251f/testing-diamond.png 975w,\n/static/2d1a81dfd1bbb2915ca11c2a50c0f8ac/72325/testing-diamond.png 1300w,\n/static/2d1a81dfd1bbb2915ca11c2a50c0f8ac/1afd7/testing-diamond.png 1385w\"\n        sizes=\"(max-width: 650px) 100vw, 650px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<h2 id=\"test-structure\" style=\"position:relative;\"><a href=\"#test-structure\" aria-label=\"test structure permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Test structure</h2>\n<h2 id=\"arrange-act-assert\" style=\"position:relative;\"><a href=\"#arrange-act-assert\" aria-label=\"arrange act assert permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Arrange-Act-Assert</h2>\n<p>In general tests should follow the format of:</p>\n<ul>\n<li><strong>Arrange</strong> all necessary preconditions and input</li>\n<li><strong>Act</strong> upon the object or method</li>\n<li><strong>Assert</strong> that the expected results have occurred</li>\n</ul>\n<p>For example:</p>\n\n            <div class=\"code-snippet\">\n              \n              <div class=\"gatsby-highlight\">\n                <pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token comment\"># Arrange - insert values into the database, mock library calls, etc.</span>\nallow<span class=\"token punctuation\">(</span>external_library<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to receive<span class=\"token punctuation\">(</span><span class=\"token symbol\">:some_method</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>and_return<span class=\"token punctuation\">(</span><span class=\"token symbol\">:mocked_value</span><span class=\"token punctuation\">)</span>\n<span class=\"token constant\">Database</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token constant\">User</span><span class=\"token punctuation\">.</span>insert<span class=\"token punctuation\">(</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># Act</span>\nresult <span class=\"token operator\">=</span> subject<span class=\"token punctuation\">.</span>create_blog<span class=\"token punctuation\">(</span>title<span class=\"token punctuation\">:</span> <span class=\"token string\">'...'</span><span class=\"token punctuation\">,</span> content<span class=\"token punctuation\">:</span> <span class=\"token string\">'..'</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># Assert</span>\nexpect<span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">.</span>title<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to eq<span class=\"token punctuation\">(</span><span class=\"token string\">'...'</span><span class=\"token punctuation\">)</span>\nexpect<span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">.</span>content<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to eq<span class=\"token punctuation\">(</span><span class=\"token string\">'...'</span><span class=\"token punctuation\">)</span></code></pre>\n              </div>\n            </div>\n          \n<h2 id=\"coverage-tools\" style=\"position:relative;\"><a href=\"#coverage-tools\" aria-label=\"coverage tools permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Coverage tools</h2>\n<p>These tools are <strong>useful for highlighting code paths that are not tested</strong>, for instance this is the output of <a href=\"https://github.com/simplecov-ruby/simplecov\"><strong>simplecov</strong></a>:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 650px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/c90a243e9441cbf66023cfbe252a1fdf/5ed30/coverage-testing.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 95.05494505494505%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAYAAACQjC21AAAACXBIWXMAABYlAAAWJQFJUiTwAAADmUlEQVQ4y4XUWXPbZBQGYP8/BprYScslQxn4H3AfLtpQksyklIa22coMA1kmCbSQJrKtxfIWS/IiWftma3FcLph5OZbchbYzXDzznu/MZ40+6ViFz25/hY2NTYhiEyxbA8eJ4MmrFPj6/+JJrdbEX+eXKHyysIi1x99j9E8IbTyAkegZPR7CTA04Uztjz/Nd7jytiQW2XkVhobiEjR/WEU9jWIEFJ3TgjOaotgM7F76T81p1Heg+XXjkotVpoVAsLePH+w/w9/VLeLaLwPHhv04PIy/M+SOEXvBmPacZY9j2CJMohTE0UFi69SlWt+5i4EoQOgxEtQbJu4ISKhjQI9BiDVqi5Tmv1ViFGqlZDhOV+nl9zp7TkUslrDxdgRDyOJNO8Ef3d3AOi5rDoTzicRlwYNwymJDLOQyESEB9UoeYiqglYpY87d053kFhcWkJd3fvoBNegbVrqLn0xgwBvNOA4NBbNKk2OAiWkOF1qg2e+jxE2t8KmpATCe2whYPnB3Tkm7ewsbMJPbHQMuiofg+y10U3HEDx8voVxe9T9iC5CmQ373WDPvTUpqNbKIssCqXSTeyv3kMqd9G7uMSwXIVeZTFgyvDrDUwkBWlH/qDkSsqkHQVTuQdTrNORF0s4+OZrTM9OcfXwIfrb2+g9eQJz7ymCX35FenSM+OiQHCEh8eEhkuOjbD09OcH09ATXlC8p9UM68gJd8PH6GlLDwLDVgi3LcMhIGWDcHcCVFVhSJ+8rclbnKWGsDhBpaiYeahg0GnSHRZrDB1tIJ1OMxzGS9BpxkiKaS5JJ1suSpLOapOk03xtPEMVpttYNE4UbxSJWt++g7bVwIb1AtVcGq3LgtBp4SqZ7iWq/jEqPybLcZXIKg5ouQIkVIkMKOzj+84jucHkZ3/68AtZncaac4Vn/Gf2QAder4EJ9gdN5b6biVlCezaTNZNiAhTifQ45m9NFvj/KxWftpDWZkQtIlDC0VA6sPNdRgxAaMyMiTmLEJM3kLrfWxnu2ZZUWo5H+9e1vfQRtp6NNMDaPhG/EHUF+LtPfosY5Lnj5fH318Axub60iuI2imCtM13mM4OkxizFmeSSy4oQt/7MMbeQiiAJIiofD5F19if28P0+k1PJe+Mr6PMAiyfNusF4b0hSFRFCGO4v9IaSI0VUNhZ3cfV+026nURjUYdTZqlWTbquWqVXgTDZFiWRZtmtdVsvtbMNNBut7C7u4t/AdRdLStPV4NEAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Coverage testing\"\n        title=\"Coverage testing\"\n        src=\"/static/c90a243e9441cbf66023cfbe252a1fdf/dc2fe/coverage-testing.png\"\n        srcset=\"/static/c90a243e9441cbf66023cfbe252a1fdf/fc8b9/coverage-testing.png 163w,\n/static/c90a243e9441cbf66023cfbe252a1fdf/d53b1/coverage-testing.png 325w,\n/static/c90a243e9441cbf66023cfbe252a1fdf/dc2fe/coverage-testing.png 650w,\n/static/c90a243e9441cbf66023cfbe252a1fdf/6251f/coverage-testing.png 975w,\n/static/c90a243e9441cbf66023cfbe252a1fdf/72325/coverage-testing.png 1300w,\n/static/c90a243e9441cbf66023cfbe252a1fdf/5ed30/coverage-testing.png 1820w\"\n        sizes=\"(max-width: 650px) 100vw, 650px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<h2 id=\"mutation-testing\" style=\"position:relative;\"><a href=\"#mutation-testing\" aria-label=\"mutation testing permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Mutation testing</h2>\n<p>Mutation involves rewriting the code under test in various ways, called mutant. For instance by rewriting predicate expressions and running the test suite again:</p>\n\n            <div class=\"code-snippet\">\n              \n              <div class=\"gatsby-highlight\">\n                <pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token comment\"># original code</span>\n<span class=\"token keyword\">if</span> a <span class=\"token operator\">&amp;&amp;</span> b\n  c <span class=\"token operator\">=</span> <span class=\"token number\">1</span>\n<span class=\"token keyword\">else</span>\n  c <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n<span class=\"token keyword\">end</span>\n\n<span class=\"token comment\"># mutant generated, and test suite-rerun</span>\n<span class=\"token keyword\">if</span> a <span class=\"token operator\">||</span> b\n  c <span class=\"token operator\">=</span> <span class=\"token number\">1</span>\n<span class=\"token keyword\">else</span>\n  c <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n<span class=\"token keyword\">end</span></code></pre>\n              </div>\n            </div>\n          \n<p>The existing test suite must be able to identify this new mutant code. If it does not, then the test coverage is not sufficient enough - or the implementation could be simplified.</p>\n<p>Other mutations include:</p>\n<ul>\n<li>Statement deletion</li>\n<li>Replacing booleans, i.e. true to false</li>\n<li>Modifying comparison operators from <code>></code> to <code>>=</code> or <code>==</code></li>\n<li>etc</li>\n</ul>\n<p>Tools such as <a href=\"https://github.com/mbj/mutant\">mutant</a> can be used for this</p>\n<h2 id=\"property-based-testing\" style=\"position:relative;\"><a href=\"#property-based-testing\" aria-label=\"property based testing permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Property based testing</h2>\n<p>When a developer is writing unit tests, a common approach is to:</p>\n<ul>\n<li>Decide on a finite set of test data, i.e. 1-2 happy paths, 1-2 failure paths</li>\n<li>Arrange - Create the input</li>\n<li>Act - Call the function with the input</li>\n<li>Assert - Verify the result</li>\n</ul>\n<p>Alternatively; From the lands of functional programming - tools such as Haskell's QuickCheck allow tests to be developed by asserting properties that the function under test must honor. This allows for the test library to choose arbitrary inputs to your test which follow the set pre-conditions, and for the post-conditions to be verified afterwards.</p>\n<ul>\n<li>Declare a specification of the input data</li>\n<li>Let the testing library choose arbitrary input data</li>\n<li>Verify the post conditions hold true for the result</li>\n</ul>\n<p>An example with <a href=\"https://github.com/Qqwy/ruby-prop_check\">ruby-prop_check</a>:</p>\n\n            <div class=\"code-snippet\">\n              \n              <div class=\"gatsby-highlight\">\n                <pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token keyword\">include</span> <span class=\"token constant\">PropCheck</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token constant\">Generators</span>\n\n<span class=\"token comment\"># testing that Enumerable#sort sorts in ascending order</span>\n<span class=\"token constant\">PropCheck</span><span class=\"token punctuation\">.</span>forall<span class=\"token punctuation\">(</span>array<span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">do</span> <span class=\"token operator\">|</span>numbers<span class=\"token operator\">|</span>\n  sorted_numbers <span class=\"token operator\">=</span> numbers<span class=\"token punctuation\">.</span>sort\n\n  <span class=\"token comment\"># Check that no number is smaller than the previous number</span>\n  sorted_numbers<span class=\"token punctuation\">.</span>each_cons<span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">do</span> <span class=\"token operator\">|</span>former<span class=\"token punctuation\">,</span> latter<span class=\"token operator\">|</span>\n    <span class=\"token keyword\">raise</span> <span class=\"token string\">\"Elements are not sorted! <span class=\"token interpolation\"><span class=\"token delimiter tag\">#{</span>latter<span class=\"token delimiter tag\">}</span></span> is &lt; <span class=\"token interpolation\"><span class=\"token delimiter tag\">#{</span>former<span class=\"token delimiter tag\">}</span></span>\"</span> <span class=\"token keyword\">if</span> latter <span class=\"token operator\">&lt;</span> former\n  <span class=\"token keyword\">end</span>\n<span class=\"token keyword\">end</span></code></pre>\n              </div>\n            </div>\n          \n<h2 id=\"rspec-cheat-sheet\" style=\"position:relative;\"><a href=\"#rspec-cheat-sheet\" aria-label=\"rspec cheat sheet permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>RSpec Cheat sheet</h2>\n<p>I recommend reading through <a href=\"https://www.betterspecs.org/\"><strong>betterspecs</strong></a> which curates a list of the current best practices for writing RSpec tests.</p>\n<h3 id=\"example\" style=\"position:relative;\"><a href=\"#example\" aria-label=\"example permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Example</h3>\n<p>RSpec provides a domain specific language for writing tests. For <em>unit tests</em> you will want to <em>use the real class name in the top level describe</em> to signify the class that you are wishing to test. This will allow RSpec to load the class that is being tested, as well as provide access to useful helper methods later:</p>\n\n            <div class=\"code-snippet\">\n              \n              <div class=\"gatsby-highlight\">\n                <pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token comment\"># If you're testing a class in isolation</span>\n<span class=\"token constant\">RSpec</span><span class=\"token punctuation\">.</span>describe <span class=\"token constant\">SomeClass</span> <span class=\"token keyword\">do</span>\n  <span class=\"token comment\"># ...</span>\n<span class=\"token keyword\">end</span></code></pre>\n              </div>\n            </div>\n          \n<p>For system/end-to-end tests there will be a readable string for the describe argument, instead of the Ruby class that is being tested:</p>\n\n            <div class=\"code-snippet\">\n              \n              <div class=\"gatsby-highlight\">\n                <pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token comment\"># If you're writing system/end-to-end tests</span>\n<span class=\"token constant\">RSpec</span><span class=\"token punctuation\">.</span>describe <span class=\"token string\">'Blog management system'</span> <span class=\"token keyword\">do</span>\n  <span class=\"token comment\"># ...</span>\n<span class=\"token keyword\">end</span></code></pre>\n              </div>\n            </div>\n          \n<h3 id=\"conventions\" style=\"position:relative;\"><a href=\"#conventions\" aria-label=\"conventions permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Conventions</h3>\n<p>If you were wishing to test a class such as:</p>\n\n            <div class=\"code-snippet\">\n              \n              <div class=\"gatsby-highlight\">\n                <pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">Person</span>\n  <span class=\"token keyword\">def</span> <span class=\"token method-definition\"><span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span><span class=\"token function\">class_method</span></span>\n    <span class=\"token comment\"># ...</span>\n  <span class=\"token keyword\">end</span>\n\n  <span class=\"token keyword\">def</span> <span class=\"token method-definition\"><span class=\"token function\">instance_method</span></span>\n    <span class=\"token comment\"># ...</span>\n  <span class=\"token keyword\">end</span>\n<span class=\"token keyword\">end</span></code></pre>\n              </div>\n            </div>\n          \n<p>If you're testing an instance method:</p>\n\n            <div class=\"code-snippet\">\n              \n              <div class=\"gatsby-highlight\">\n                <pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token comment\"># using the # prefix for instance methods</span>\ndescribe <span class=\"token string\">'#instance_method'</span> <span class=\"token keyword\">do</span>\n  <span class=\"token comment\"># ...</span>\n<span class=\"token keyword\">end</span></code></pre>\n              </div>\n            </div>\n          \n<p>If you're testing a class method:</p>\n\n            <div class=\"code-snippet\">\n              \n              <div class=\"gatsby-highlight\">\n                <pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token comment\"># Using the `.` prefix for class methods</span>\ndescribe <span class=\"token string\">'.class_method'</span> <span class=\"token keyword\">do</span>\n   <span class=\"token comment\"># ...</span>\n<span class=\"token keyword\">end</span>\n\n<span class=\"token comment\"># Sometimes you will see the `::` prefix used</span>\ndescribe <span class=\"token string\">'::class_method'</span> <span class=\"token keyword\">do</span>\n   <span class=\"token comment\"># ...</span>\n<span class=\"token keyword\">end</span></code></pre>\n              </div>\n            </div>\n          \n<p>If you wish to test a method, under a combination of different contexts and variations:</p>\n\n            <div class=\"code-snippet\">\n              \n              <div class=\"gatsby-highlight\">\n                <pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token comment\"># start the contexts with `when...`, `with ...`, `without... `</span>\ndescribe <span class=\"token string\">'#instance_method'</span> <span class=\"token keyword\">do</span>\n  context <span class=\"token string\">'when the user has permissions'</span> <span class=\"token keyword\">do</span>\n    <span class=\"token comment\"># ...</span>\n  <span class=\"token keyword\">end</span>\n\n  context <span class=\"token string\">'when the user does not have permissions'</span> <span class=\"token keyword\">do</span>\n    <span class=\"token comment\"># ...</span>\n  <span class=\"token keyword\">end</span>\n<span class=\"token keyword\">end</span></code></pre>\n              </div>\n            </div>\n          \n<h3 id=\"utility-methods\" style=\"position:relative;\"><a href=\"#utility-methods\" aria-label=\"utility methods permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Utility methods</h3>\n<p>Given the following code snippet:</p>\n\n            <div class=\"code-snippet\">\n              \n              <div class=\"gatsby-highlight\">\n                <pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token constant\">RSpec</span><span class=\"token punctuation\">.</span>describe <span class=\"token constant\">Person</span> <span class=\"token keyword\">do</span>\n  <span class=\"token comment\"># ...</span>\n<span class=\"token keyword\">end</span></code></pre>\n              </div>\n            </div>\n          \n<p>The following methods are available for use:</p>\n<ul>\n<li><code>described_class</code> refers to the Person class</li>\n<li><code>subject</code> will refer to Person.new by default</li>\n</ul>\n<h3 id=\"assertions--matchers\" style=\"position:relative;\"><a href=\"#assertions--matchers\" aria-label=\"assertions  matchers permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Assertions / Matchers</h3>\n<p>When we write unit tests in the format:</p>\n\n            <div class=\"code-snippet\">\n              \n              <div class=\"gatsby-highlight\">\n                <pre class=\"language-none\"><code class=\"language-none\">calculator_result = calculator.add(2, 5)\nexpect(calculator_result).to eq(7)</code></pre>\n              </div>\n            </div>\n          \n<p>It's worth noting that this is actually just a bunch of function calls. For instance <code>eq</code> is just a function call:</p>\n\n            <div class=\"code-snippet\">\n              \n              <div class=\"gatsby-highlight\">\n                <pre class=\"language-none\"><code class=\"language-none\">calculator_result = calculator.add(2, 5)\nexpect(calculator_result).to(eq(7))</code></pre>\n              </div>\n            </div>\n          \n<p>RSpec provides multiple out of the box matchers such as:</p>\n<ul>\n<li><code>eq</code></li>\n<li><code>include</code></li>\n<li><code>match</code></li>\n<li><code>be_within(delta).of(expected)</code></li>\n<li><code>match_array</code></li>\n<li>... and more!</li>\n</ul>\n<p>It is also possible to write <strong>custom matchers</strong>:</p>\n\n            <div class=\"code-snippet\">\n              \n              <div class=\"gatsby-highlight\">\n                <pre class=\"language-ruby\"><code class=\"language-ruby\">it <span class=\"token string\">'should take a screenshot'</span> <span class=\"token keyword\">do</span>\n  screenshot <span class=\"token operator\">=</span> subject<span class=\"token punctuation\">.</span>screenshot\n  expect<span class=\"token punctuation\">(</span>screenshot<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to equal_image<span class=\"token punctuation\">(</span>expected_screenshot<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">end</span></code></pre>\n              </div>\n            </div>\n          \n<p>The following snippet shows an example of registering a new matcher with RSpec which you can use in your test:</p>\n\n            <div class=\"code-snippet\">\n              \n              <div class=\"gatsby-highlight\">\n                <pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token constant\">RSpec</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token constant\">Matchers</span><span class=\"token punctuation\">.</span>define <span class=\"token symbol\">:equal_image</span> <span class=\"token keyword\">do</span> <span class=\"token operator\">|</span>expected_path<span class=\"token operator\">|</span>\n  match <span class=\"token keyword\">do</span> <span class=\"token operator\">|</span>actual_path<span class=\"token operator\">|</span>\n    expected_pixels <span class=\"token operator\">=</span> pixels_for<span class=\"token punctuation\">(</span>expected_path<span class=\"token punctuation\">)</span>\n    actual_pixels <span class=\"token operator\">=</span> pixels_for<span class=\"token punctuation\">(</span>actual_path<span class=\"token punctuation\">)</span>\n\n    expect<span class=\"token punctuation\">(</span>expected_pixels <span class=\"token operator\">==</span> actual_pixels<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to be <span class=\"token boolean\">true</span>\n  <span class=\"token keyword\">end</span>\n\n  <span class=\"token comment\"># @param [String] path The file path to the image</span>\n  <span class=\"token keyword\">def</span> <span class=\"token method-definition\"><span class=\"token function\">pixels_for</span></span><span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">)</span>\n    image <span class=\"token operator\">=</span> <span class=\"token constant\">Magick</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token constant\">Image</span><span class=\"token punctuation\">.</span>read<span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>first\n    image<span class=\"token punctuation\">.</span>export_pixels_to_str<span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> image<span class=\"token punctuation\">.</span>columns<span class=\"token punctuation\">,</span> image<span class=\"token punctuation\">.</span>rows<span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">end</span>\n<span class=\"token keyword\">end</span></code></pre>\n              </div>\n            </div>\n          \n<h3 id=\"matchers-for-complex-structures\" style=\"position:relative;\"><a href=\"#matchers-for-complex-structures\" aria-label=\"matchers for complex structures permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Matchers for complex structures</h3>\n<p>RSpec's matchers can be used within arbitrary data structures to test complex scenarios:</p>\n\n            <div class=\"code-snippet\">\n              \n              <div class=\"gatsby-highlight\">\n                <pre class=\"language-ruby\"><code class=\"language-ruby\">expected_error_response <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  error<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n    code<span class=\"token punctuation\">:</span> <span class=\"token operator\">-</span><span class=\"token number\">32000</span><span class=\"token punctuation\">,</span>\n    data<span class=\"token punctuation\">:</span> hash_including<span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      backtrace<span class=\"token punctuation\">:</span> <span class=\"token keyword\">include</span><span class=\"token punctuation\">(</span>a_kind_of<span class=\"token punctuation\">(</span><span class=\"token builtin\">String</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    message<span class=\"token punctuation\">:</span> <span class=\"token string\">'Application server error: This module does not support check.'</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  id<span class=\"token punctuation\">:</span> <span class=\"token number\">1</span>\n<span class=\"token punctuation\">}</span>\nexpect<span class=\"token punctuation\">(</span>json_response<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to <span class=\"token keyword\">include</span><span class=\"token punctuation\">(</span>expected_error_response<span class=\"token punctuation\">)</span></code></pre>\n              </div>\n            </div>\n          \n<h2 id=\"fixing-flakey-tests\" style=\"position:relative;\"><a href=\"#fixing-flakey-tests\" aria-label=\"fixing flakey tests permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Fixing flakey tests</h2>\n<p>Tests that are unreliable, and fail non-deterministically, can be referred to as flakey tests.</p>\n<h3 id=\"order-dependent-tests\" style=\"position:relative;\"><a href=\"#order-dependent-tests\" aria-label=\"order dependent tests permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Order dependent tests</h3>\n<p>By default tests should run in a random order, but the module author may assume that they run sequentially. Sometimes a test suite can fail due to a series of tests mutating external state, and the order in which the tests run impacts the overall test result.</p>\n<p>The tests will be shuffled randomly based on an initial seed, which will be output to the stdout that ran the test suite:</p>\n\n            <div class=\"code-snippet\">\n              \n              <div class=\"gatsby-highlight\">\n                <pre class=\"language-none\"><code class=\"language-none\">Randomized with seed 1234</code></pre>\n              </div>\n            </div>\n          \n<p>Similar to <code>git bisect</code>, RSpec supports the <code>--bisect</code> flag. We can then run the test suite again, supplying the seed value:</p>\n\n            <div class=\"code-snippet\">\n              \n              <div class=\"gatsby-highlight\">\n                <pre class=\"language-none\"><code class=\"language-none\">rspec --seed 1234 --bisect</code></pre>\n              </div>\n            </div>\n          \n<p>This will then bisect the test suite until it finds the combination of tests which leads to the failure:</p>\n\n            <div class=\"code-snippet\">\n              \n              <div class=\"gatsby-highlight\">\n                <pre class=\"language-none\"><code class=\"language-none\">Bisect started using options: \"--seed 1234\"\nRunning suite to find failures... (0.16755 seconds)\nStarting bisect with 1 failing example and 9 non-failing examples.\nChecking that failure(s) are order-dependent... failure appears to be order-dependent\n\nRound 1: bisecting over non-failing examples 1-9 .. ignoring examples 6-9 (0.30166 seconds)\nRound 2: bisecting over non-failing examples 1-5 .. ignoring examples 4-5 (0.30306 seconds)\nRound 3: bisecting over non-failing examples 1-3 .. ignoring example 3 (0.33292 seconds)\nRound 4: bisecting over non-failing examples 1-2 . ignoring example 1 (0.16476 seconds)\nBisect complete! Reduced necessary non-failing examples from 9 to 1 in 1.26 seconds.\n\nThe minimal reproduction command is:\n  rspec ./spec/calculator_10_spec.rb[1:1] ./spec/calculator_1_spec.rb[1:1] --seed 1234</code></pre>\n              </div>\n            </div>\n          \n<h3 id=\"ignoring-array-order\" style=\"position:relative;\"><a href=\"#ignoring-array-order\" aria-label=\"ignoring array order permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Ignoring array order</h3>\n<p>Tests can sometimes fail due to an array being returned in a different order. For instance, retrieving values from a database which are not explicitly ordered. To fix this, either fix the implementation to be deterministic, or update the matcher:</p>\n\n            <div class=\"code-snippet\">\n              \n              <div class=\"gatsby-highlight\">\n                <pre class=\"language-ruby\"><code class=\"language-ruby\">expect<span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to    eq<span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token comment\"># pass</span>\nexpect<span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to    eq<span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token comment\"># fail</span>\nexpect<span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to    match_array<span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token comment\"># pass</span>\n\nexpect<span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to    contain_exactly<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">)</span> <span class=\"token comment\"># pass</span>\nexpect<span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token symbol\">:a</span><span class=\"token punctuation\">,</span> <span class=\"token symbol\">:c</span><span class=\"token punctuation\">,</span> <span class=\"token symbol\">:b</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to contain_exactly<span class=\"token punctuation\">(</span><span class=\"token symbol\">:a</span><span class=\"token punctuation\">,</span> <span class=\"token symbol\">:c</span> <span class=\"token punctuation\">)</span> <span class=\"token comment\"># fail</span></code></pre>\n              </div>\n            </div>\n          \n<p>The RSpec matcher output will make it clear what has failed:</p>\n\n            <div class=\"code-snippet\">\n              \n              <div class=\"gatsby-highlight\">\n                <pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token constant\">Failure</span><span class=\"token operator\">/</span><span class=\"token constant\">Error</span><span class=\"token punctuation\">:</span> it <span class=\"token punctuation\">{</span> is_expected<span class=\"token punctuation\">.</span>to contain_exactly<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">}</span>\n\n  expected collection contained<span class=\"token punctuation\">:</span>  <span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">]</span>\n  actual collection contained<span class=\"token punctuation\">:</span>    <span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">]</span>\n  the missing elements were<span class=\"token punctuation\">:</span>      <span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span>\n  the extra elements were<span class=\"token punctuation\">:</span>        <span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span></code></pre>\n              </div>\n            </div>\n          \n<h3 id=\"it-works-on-my-machine\" style=\"position:relative;\"><a href=\"#it-works-on-my-machine\" aria-label=\"it works on my machine permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>It works on my machine</h3>\n<p>In some scenarios your test suite may fail on CI, but tests will pass locally on a development machine. This can be caused by environment differences between CI and your local environment.</p>\n<p>It's worth verifying the file names of paths within your codebase, as well as the file name that is actually stored on disk, as <strong>Linux has a case sensitive-file system</strong>. Any misalignment here could cause issues on a Linux environment, but work for a Mac/Windows machine.</p>\n<p>Another difference is locale environment variables which configure the language, country, and character encoding settings for your machine. It's worth verifying these values via the <code>locale</code> command:</p>\n\n            <div class=\"code-snippet\">\n              \n              <div class=\"gatsby-highlight\">\n                <pre class=\"language-bash\"><code class=\"language-bash\">$ locale\n<span class=\"token assign-left variable\"><span class=\"token environment constant\">LANG</span></span><span class=\"token operator\">=</span><span class=\"token string\">\"en_GB.UTF-8\"</span>\n<span class=\"token assign-left variable\">LC_COLLATE</span><span class=\"token operator\">=</span><span class=\"token string\">\"en_GB.UTF-8\"</span>\n<span class=\"token assign-left variable\">LC_CTYPE</span><span class=\"token operator\">=</span><span class=\"token string\">\"en_GB.UTF-8\"</span>\n<span class=\"token assign-left variable\">LC_MESSAGES</span><span class=\"token operator\">=</span><span class=\"token string\">\"en_GB.UTF-8\"</span>\n<span class=\"token assign-left variable\"><span class=\"token environment constant\">LC_MONETARY</span></span><span class=\"token operator\">=</span><span class=\"token string\">\"en_GB.UTF-8\"</span>\n<span class=\"token assign-left variable\"><span class=\"token environment constant\">LC_NUMERIC</span></span><span class=\"token operator\">=</span><span class=\"token string\">\"en_GB.UTF-8\"</span>\n<span class=\"token assign-left variable\"><span class=\"token environment constant\">LC_TIME</span></span><span class=\"token operator\">=</span><span class=\"token string\">\"en_GB.UTF-8\"</span>\n<span class=\"token assign-left variable\"><span class=\"token environment constant\">LC_ALL</span></span><span class=\"token operator\">=</span></code></pre>\n              </div>\n            </div>\n          \n<h3 id=\"testing-side-effects\" style=\"position:relative;\"><a href=\"#testing-side-effects\" aria-label=\"testing side effects permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Testing side-effects</h3>\n<p>RSpec provides a nice matcher for the verifying that a method call has changed state:</p>\n\n            <div class=\"code-snippet\">\n              \n              <div class=\"gatsby-highlight\">\n                <pre class=\"language-ruby\"><code class=\"language-ruby\">expect <span class=\"token punctuation\">{</span> <span class=\"token constant\">Models</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token constant\">User</span><span class=\"token punctuation\">.</span>delete_All <span class=\"token punctuation\">}</span><span class=\"token punctuation\">.</span>to change <span class=\"token punctuation\">{</span> <span class=\"token constant\">Models</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token constant\">User</span><span class=\"token punctuation\">.</span>count <span class=\"token punctuation\">}</span><span class=\"token punctuation\">.</span>from<span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\nexpect <span class=\"token punctuation\">{</span> <span class=\"token constant\">Models</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token constant\">User</span><span class=\"token punctuation\">.</span>delete_All <span class=\"token punctuation\">}</span><span class=\"token punctuation\">.</span>to change <span class=\"token punctuation\">{</span> <span class=\"token constant\">Models</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token constant\">User</span><span class=\"token punctuation\">.</span>count <span class=\"token punctuation\">}</span><span class=\"token punctuation\">.</span>by<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token comment\"># Often preferred</span></code></pre>\n              </div>\n            </div>\n          \n<h3 id=\"time-travel\" style=\"position:relative;\"><a href=\"#time-travel\" aria-label=\"time travel permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Time travel</h3>\n<p>Although it's best practice to test functions in isolation without needing to mock out time, it can be useful. For this reason <strong>Timecop</strong> can be used which is a gem providing \"time travel\" and \"time freezing\" capabilities, making it dead simple to test time-dependent code. It provides a unified method to mock Time.now, Date.today, and DateTime.now in a single call.</p>\n\n            <div class=\"code-snippet\">\n              \n              <div class=\"gatsby-highlight\">\n                <pre class=\"language-ruby\"><code class=\"language-ruby\">before<span class=\"token punctuation\">(</span><span class=\"token symbol\">:each</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">do</span>\n  <span class=\"token constant\">Timecop</span><span class=\"token punctuation\">.</span>freeze<span class=\"token punctuation\">(</span><span class=\"token builtin\">Time</span><span class=\"token punctuation\">.</span>local<span class=\"token punctuation\">(</span><span class=\"token number\">2008</span><span class=\"token punctuation\">,</span> <span class=\"token number\">9</span><span class=\"token punctuation\">,</span> <span class=\"token number\">5</span><span class=\"token punctuation\">,</span> <span class=\"token number\">10</span><span class=\"token punctuation\">,</span> <span class=\"token number\">5</span><span class=\"token punctuation\">,</span> <span class=\"token number\">30</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">end</span>\n\nafter<span class=\"token punctuation\">(</span><span class=\"token symbol\">:each</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">do</span>\n  <span class=\"token constant\">Timecop</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">return</span>\n<span class=\"token keyword\">end</span></code></pre>\n              </div>\n            </div>\n          \n<p>Timecop can also time travel to new points in time during a test run:</p>\n\n            <div class=\"code-snippet\">\n              \n              <div class=\"gatsby-highlight\">\n                <pre class=\"language-ruby\"><code class=\"language-ruby\">expect<span class=\"token punctuation\">(</span>joe<span class=\"token punctuation\">.</span>mortgage_due<span class=\"token operator\">?</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to be <span class=\"token boolean\">false</span>\n\n<span class=\"token comment\"># move ahead a month and assert that the mortgage is due</span>\n<span class=\"token constant\">Timecop</span><span class=\"token punctuation\">.</span>freeze<span class=\"token punctuation\">(</span><span class=\"token constant\">Date</span><span class=\"token punctuation\">.</span>today <span class=\"token operator\">+</span> <span class=\"token number\">30</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">do</span>\n  expect<span class=\"token punctuation\">(</span>joe<span class=\"token punctuation\">.</span>mortgage_due<span class=\"token operator\">?</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to be <span class=\"token boolean\">true</span>\n<span class=\"token keyword\">end</span></code></pre>\n              </div>\n            </div>\n          \n<h3 id=\"data-driven-tests\" style=\"position:relative;\"><a href=\"#data-driven-tests\" aria-label=\"data driven tests permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Data driven tests</h3>\n<p>Data-Driven tests can be useful to generate multiple test permutations:</p>\n\n            <div class=\"code-snippet\">\n              \n              <div class=\"gatsby-highlight\">\n                <pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token punctuation\">[</span>\n  <span class=\"token keyword\">nil</span><span class=\"token punctuation\">,</span>\n  <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">''</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'        '</span>\n<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">each</span> <span class=\"token keyword\">do</span> <span class=\"token operator\">|</span>input<span class=\"token operator\">|</span>\n  context <span class=\"token string\">\"when the input is <span class=\"token interpolation\"><span class=\"token delimiter tag\">#{</span>input<span class=\"token delimiter tag\">}</span></span>\"</span> <span class=\"token keyword\">do</span>\n   it <span class=\"token string\">'should return false'</span> <span class=\"token keyword\">do</span>\n    expect<span class=\"token punctuation\">(</span>subject<span class=\"token punctuation\">.</span>verify<span class=\"token punctuation\">(</span>input<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to eq<span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span>\n   <span class=\"token keyword\">end</span>\n  <span class=\"token keyword\">end</span>\n<span class=\"token keyword\">end</span></code></pre>\n              </div>\n            </div>\n          \n<h2 id=\"avoid-testing-real-services\" style=\"position:relative;\"><a href=\"#avoid-testing-real-services\" aria-label=\"avoid testing real services permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Avoid testing real services</h2>\n<p>If possible, you should avoid testing against real services. We do this to ensure the speed and stability of the testing framework. For instance, if the remote service dies - we would not want that to impact test runs locally or in CI environments.</p>\n<p>Ways to avoid this include mocking external dependencies:</p>\n\n            <div class=\"code-snippet\">\n              \n              <div class=\"gatsby-highlight\">\n                <pre class=\"language-ruby\"><code class=\"language-ruby\">before<span class=\"token punctuation\">(</span><span class=\"token symbol\">:each</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">do</span>\n  allow<span class=\"token punctuation\">(</span>third_party_library<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to receive<span class=\"token punctuation\">(</span><span class=\"token symbol\">:get_user</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>with<span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>and_return<span class=\"token punctuation\">(</span>mock_user<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">end</span></code></pre>\n              </div>\n            </div>\n          \n<p>Or use a tool such as <a href=\"https://github.com/vcr/vcr\"><strong>VCR</strong></a> which can record the initial HTTP calls with a web service, and save the files locally. Future test runs will make use of the locally saved test files and not make real HTTP requests:</p>\n\n            <div class=\"code-snippet\">\n              \n              <div class=\"gatsby-highlight\">\n                <pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token keyword\">require</span> <span class=\"token string\">'vcr'</span>\n\n<span class=\"token constant\">VCR</span><span class=\"token punctuation\">.</span>configure <span class=\"token keyword\">do</span> <span class=\"token operator\">|</span>c<span class=\"token operator\">|</span>\n  c<span class=\"token punctuation\">.</span>cassette_library_dir <span class=\"token operator\">=</span> <span class=\"token string\">'spec/cassettes'</span>\n  c<span class=\"token punctuation\">.</span>hook_into <span class=\"token symbol\">:webmock</span>\n  c<span class=\"token punctuation\">.</span>configure_rspec_metadata<span class=\"token operator\">!</span>\n<span class=\"token keyword\">end</span></code></pre>\n              </div>\n            </div>\n          \n<p>With a unit test:</p>\n\n            <div class=\"code-snippet\">\n              \n              <div class=\"gatsby-highlight\">\n                <pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token keyword\">require</span> <span class=\"token string\">'spec_helper'</span>\n\n<span class=\"token keyword\">def</span> <span class=\"token method-definition\"><span class=\"token function\">make_http_request</span></span>\n  <span class=\"token constant\">Net</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token constant\">HTTP</span><span class=\"token punctuation\">.</span>get_response<span class=\"token punctuation\">(</span><span class=\"token string\">'localhost'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'/'</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$server</span><span class=\"token punctuation\">.</span>port<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>body\n<span class=\"token keyword\">end</span>\n\n<span class=\"token constant\">RSpec</span><span class=\"token punctuation\">.</span>describe <span class=\"token string\">'VCR example group metadata'</span><span class=\"token punctuation\">,</span> <span class=\"token symbol\">:vcr</span> <span class=\"token keyword\">do</span>\n  it <span class=\"token string\">'records an http request'</span> <span class=\"token keyword\">do</span>\n    expect<span class=\"token punctuation\">(</span>make_http_request<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to eq<span class=\"token punctuation\">(</span><span class=\"token string\">'Hello'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">end</span>\n<span class=\"token keyword\">end</span></code></pre>\n              </div>\n            </div>\n          \n<p>When the test first runs this will generate a cassette file which is saved to disk for future use:</p>\n\n            <div class=\"code-snippet\">\n              \n              <div class=\"gatsby-highlight\">\n                <pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token punctuation\">---</span>\n<span class=\"token key atrule\">http_interactions</span><span class=\"token punctuation\">:</span>\n<span class=\"token punctuation\">-</span> <span class=\"token key atrule\">request</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">method</span><span class=\"token punctuation\">:</span> get\n    <span class=\"token key atrule\">uri</span><span class=\"token punctuation\">:</span> http<span class=\"token punctuation\">:</span>//example.com/foo\n    <span class=\"token key atrule\">body</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">encoding</span><span class=\"token punctuation\">:</span> UTF<span class=\"token punctuation\">-</span><span class=\"token number\">8</span>\n      <span class=\"token key atrule\">string</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"\"</span>\n    <span class=\"token key atrule\">headers</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n  <span class=\"token key atrule\">response</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">status</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">code</span><span class=\"token punctuation\">:</span> <span class=\"token number\">200</span>\n      <span class=\"token key atrule\">message</span><span class=\"token punctuation\">:</span> OK\n    <span class=\"token key atrule\">headers</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">Content-Length</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token string\">\"5\"</span>\n    <span class=\"token key atrule\">body</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">encoding</span><span class=\"token punctuation\">:</span> UTF<span class=\"token punctuation\">-</span><span class=\"token number\">8</span>\n      <span class=\"token key atrule\">string</span><span class=\"token punctuation\">:</span> Hello\n    <span class=\"token key atrule\">http_version</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"1.1\"</span>\n  <span class=\"token key atrule\">recorded_at</span><span class=\"token punctuation\">:</span> Tue<span class=\"token punctuation\">,</span> 01 Nov 2011 04<span class=\"token punctuation\">:</span>58<span class=\"token punctuation\">:</span>44 GMT\n<span class=\"token key atrule\">recorded_with</span><span class=\"token punctuation\">:</span> VCR 2.0.0</code></pre>\n              </div>\n            </div>\n          \n<p>There is also <a href=\"https://github.com/robforman/tcr\"><strong>TCR</strong></a> for recording TCP/binary requests. This file is not stored in a human readable format like VCR's yaml output. Instead it uses Ruby's <a href=\"https://ruby-doc.org/core-3.1.0/Marshal.html\">Marshal</a> library - which is not human readable and may suffer from deserialization attacks. This would especially be a concern if malicious pull requests were to be accepted as part of open source projects.</p>\n<p>Configuration example:</p>\n\n            <div class=\"code-snippet\">\n              \n              <div class=\"gatsby-highlight\">\n                <pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token constant\">TCR</span><span class=\"token punctuation\">.</span>configure <span class=\"token keyword\">do</span> <span class=\"token operator\">|</span>config<span class=\"token operator\">|</span>\n  config<span class=\"token punctuation\">.</span>hook_tcp_ports <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token number\">5902</span><span class=\"token punctuation\">]</span>\n  config<span class=\"token punctuation\">.</span>format <span class=\"token operator\">=</span> <span class=\"token string\">'marshal'</span>\n  config<span class=\"token punctuation\">.</span>cassette_library_dir <span class=\"token operator\">=</span> <span class=\"token builtin\">File</span><span class=\"token punctuation\">.</span>join<span class=\"token punctuation\">(</span><span class=\"token constant\">FIXTURES_ROOT</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'tcr'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">end</span></code></pre>\n              </div>\n            </div>\n          \n<p>Wiring up the casette functionality to our test suite:</p>\n\n            <div class=\"code-snippet\">\n              \n              <div class=\"gatsby-highlight\">\n                <pre class=\"language-ruby\"><code class=\"language-ruby\">around<span class=\"token punctuation\">(</span><span class=\"token symbol\">:each</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">do</span> <span class=\"token operator\">|</span>example<span class=\"token operator\">|</span>\n  cassette_name <span class=\"token operator\">=</span> test_name_for<span class=\"token punctuation\">(</span>example<span class=\"token punctuation\">)</span>\n  <span class=\"token constant\">TCR</span><span class=\"token punctuation\">.</span>use_cassette<span class=\"token punctuation\">(</span>cassette_name<span class=\"token punctuation\">)</span> <span class=\"token keyword\">do</span>\n    example<span class=\"token punctuation\">.</span>run cassette_name\n  <span class=\"token keyword\">end</span>\n<span class=\"token keyword\">end</span>\n\nit <span class=\"token string\">'should take a screenshot'</span> <span class=\"token keyword\">do</span>\n  screenshot <span class=\"token operator\">=</span> subject<span class=\"token punctuation\">.</span>screenshot\n  expect<span class=\"token punctuation\">(</span>screenshot<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to equal_image<span class=\"token punctuation\">(</span>expected_screenshot<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">end</span></code></pre>\n              </div>\n            </div>\n          ","frontmatter":{"title":"Testing approaches in Ruby","date":"30 August, 2022"},"fields":{"slug":"/posts/testing-approaches-in-ruby/","editURL":"https://github.com/AlanFoster/alanfoster.github.io/edit/develop/src/pages/posts/testing-approaches-in-ruby/index.markdown"}}},"pageContext":{"sidebarPath":null,"slug":"/posts/testing-approaches-in-ruby/"}}}